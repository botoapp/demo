(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f96a4f0"],{"05d4":function(t,e,i){"use strict";i("b9cd")},"10d0":function(t,e,i){},2209:function(t,e,i){},"250d":function(t,e,i){"use strict";i("9dfc")},"25a0":function(t,e,i){"use strict";var n=i("72dd");function s(t){return s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function l(t){return d(t)||c(t)||u(t)||p()}function d(t){if(Array.isArray(t))return h(t)}function c(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function u(t,e){if(t){if("string"===typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object.keys(t).reduce((function(i,s){return e.includes(s)||(i[s]=Object(n["n"])(t[s])),i}),{})}function f(t){return"function"===typeof t}function m(t){return Object(n["d"])(t)||Object(n["e"])(t)}function v(t,e,i){if(i)return e?e(t()):t();try{var n=Promise.resolve(t());return e?n.then(e):n}catch(s){return Promise.reject(s)}}var b="__root";function w(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];try{return Promise.resolve(t.apply(this,e))}catch(n){return Promise.reject(n)}}}function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(n["n"])(t),i=Object.keys(e),s={},o={},a={};return i.forEach((function(t){var i=e[t];switch(!0){case f(i.$validator):s[t]=i;break;case f(i):s[t]={$validator:i};break;case t.startsWith("$"):a[t]=i;break;default:o[t]=i}})),{rules:s,nestedValidators:o,config:a}}function _(t,e,i){var s=Object(n["n"])(e);return t.call(i,s,i)}function O(t){return void 0!==t.$valid?!t.$valid:!t}function x(t,e,i,o,a,r,l){var d=a.$lazy,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],u=Object(n["m"])(!!o.value),h=Object(n["m"])(0);i.value=!1;var p=Object(n["o"])([e,o].concat(c),(function(){if(d&&!o.value)return!1;var n;try{n=_(t,e,l)}catch(s){n=Promise.reject(s)}h.value++,i.value=!!h.value,u.value=!0,Promise.resolve(n).then((function(t){h.value--,i.value=!!h.value,r.value=t,u.value=O(t)}))["catch"]((function(t){h.value--,i.value=!!h.value,r.value=t,u.value=!0}))}),{immediate:!0,deep:"object"===s(e)});return{$invalid:u,$unwatch:p}}function C(t,e,i,s,o,a){var r=s.$lazy,l=function(){return{}},d=Object(n["a"])((function(){if(r&&!i.value)return!1;try{var n=_(t,e,a);return o.value=n,O(n)}catch(s){o.value=s}return!0}));return{$unwatch:l,$invalid:d}}function T(t,e,i,s,o,a,r,l){var d,c,u=Object(n["m"])(!1),h=t.$params||{},p=Object(n["m"])(null);if(t.$async){var m=x(t.$validator,e,u,i,s,p,o,t.$watchTargets);d=m.$invalid,c=m.$unwatch}else{var v=C(t.$validator,e,i,s,p,o);d=v.$invalid,c=v.$unwatch}var b=t.$message,w=f(b)?Object(n["a"])((function(){return b(g({$pending:u,$invalid:d,$params:g(h),$model:e,$response:p,$validator:a,$propertyPath:l,$property:r}))})):b||"";return{$message:w,$params:h,$pending:u,$invalid:d,$response:p,$unwatch:c}}function k(t,e,i,s,o,a,r,l){var d=Object.keys(t),c=s.get(o,t),u=Object(n["m"])(!1);if(c){if(!c.$partial)return c;c.$unwatch(),u.value=c.$dirty.value}var h={$dirty:u,$path:o,$touch:function(){u.value||(u.value=!0)},$reset:function(){u.value&&(u.value=!1)}};return d.length?(d.forEach((function(n){h[n]=T(t[n],e,h.$dirty,a,r,n,i,o)})),h.$externalResults=Object(n["a"])((function(){return l.value?[].concat(l.value).map((function(t,e){return{$propertyPath:o,$property:i,$validator:"$externalResults",$uid:"".concat(o,"-").concat(e),$message:t,$params:{},$response:null,$pending:!1}})):[]})),h.$invalid=Object(n["a"])((function(){return!!h.$externalResults.value.length||d.some((function(t){return Object(n["n"])(h[t].$invalid)}))})),h.$pending=Object(n["a"])((function(){return d.some((function(t){return Object(n["n"])(h[t].$pending)}))})),h.$error=Object(n["a"])((function(){return h.$invalid.value&&h.$dirty.value})),h.$silentErrors=Object(n["a"])((function(){return d.filter((function(t){return Object(n["n"])(h[t].$invalid)})).map((function(t){var e=h[t];return Object(n["l"])({$propertyPath:o,$property:i,$validator:t,$uid:"".concat(o,"-").concat(t),$message:e.$message,$params:e.$params,$response:e.$response,$pending:e.$pending})})).concat(h.$externalResults.value)})),h.$errors=Object(n["a"])((function(){return h.$dirty.value?h.$silentErrors.value:[]})),h.$unwatch=function(){return d.forEach((function(t){h[t].$unwatch()}))},s.set(o,t,h),h):(c&&s.set(o,t,h),h)}function N(t,e,i,n,s,o,a){var r=Object.keys(t);return r.length?r.reduce((function(r,l){return r[l]=S({validations:t[l],state:e,key:l,parentKey:i,resultsCache:n,globalConfig:s,instance:o,externalResults:a}),r}),{}):{}}function j(t,e,i){var s=Object(n["a"])((function(){return[e,i].filter((function(t){return t})).reduce((function(t,e){return t.concat(Object.values(Object(n["n"])(e)))}),[])})),o=Object(n["a"])({get:function(){return t.$dirty.value||!!s.value.length&&s.value.every((function(t){return t.$dirty}))},set:function(e){t.$dirty.value=e}}),a=Object(n["a"])((function(){var e=Object(n["n"])(t.$silentErrors)||[],i=s.value.filter((function(t){return(Object(n["n"])(t).$silentErrors||[]).length})).reduce((function(t,e){return t.concat.apply(t,l(e.$silentErrors))}),[]);return e.concat(i)})),r=Object(n["a"])((function(){var e=Object(n["n"])(t.$errors)||[],i=s.value.filter((function(t){return(Object(n["n"])(t).$errors||[]).length})).reduce((function(t,e){return t.concat.apply(t,l(e.$errors))}),[]);return e.concat(i)})),d=Object(n["a"])((function(){return s.value.some((function(t){return t.$invalid}))||Object(n["n"])(t.$invalid)||!1})),c=Object(n["a"])((function(){return s.value.some((function(t){return Object(n["n"])(t.$pending)}))||Object(n["n"])(t.$pending)||!1})),u=Object(n["a"])((function(){return s.value.some((function(t){return t.$dirty}))||s.value.some((function(t){return t.$anyDirty}))||o.value})),h=Object(n["a"])((function(){return d.value&&o.value||!1})),p=function(){t.$touch(),s.value.forEach((function(t){t.$touch()}))},g=function(){t.$reset(),s.value.forEach((function(t){t.$reset()}))};return s.value.length&&s.value.every((function(t){return t.$dirty}))&&p(),{$dirty:o,$errors:r,$invalid:d,$anyDirty:u,$error:h,$pending:c,$touch:p,$reset:g,$silentErrors:a}}function S(t){var e=t.validations,i=t.state,s=t.key,o=t.parentKey,a=t.childResults,r=t.resultsCache,l=t.globalConfig,d=void 0===l?{}:l,c=t.instance,u=t.externalResults,h=o?"".concat(o,".").concat(s):s,p=y(e),g=p.rules,f=p.nestedValidators,m=p.config,_=Object.assign({},d,m),O=s?Object(n["a"])((function(){var t=Object(n["n"])(i);return t?Object(n["n"])(t[s]):void 0})):i,x=Object.assign({},Object(n["n"])(u)||{}),C=Object(n["a"])((function(){var t=Object(n["n"])(u);return s?t?Object(n["n"])(t[s]):void 0:t})),T=k(g,O,s,r,h,_,c,C),S=N(f,O,h,r,_,c,C),E=j(T,S,a),$=E.$dirty,L=E.$errors,I=E.$invalid,B=E.$anyDirty,D=E.$error,M=E.$pending,A=E.$touch,R=E.$reset,V=E.$silentErrors,H=s?Object(n["a"])({get:function(){return Object(n["n"])(O)},set:function(t){$.value=!0;var e=Object(n["n"])(i);Object(n["f"])(e[s])?e[s].value=t:e[s]=t}}):null;if(s&&_.$autoDirty)var z=Object(n["o"])(O,(function(){var t="_".concat(h,"_$watcher_"),e=r.get(t,{});$.value||A(),e&&e.$unwatch(),r.set(t,{},{$unwatch:z})}),{flush:"sync"});function P(){return new Promise(w((function(t){return $.value||A(),v(n["h"],(function(){if(!M.value)return t(!I.value);var e=Object(n["o"])(M,(function(){t(!I.value),e()}))}))})))}function F(t){return(a.value||{})[t]}function q(){Object(n["f"])(u)?u.value=x:0===Object.keys(x).length?Object.keys(u).forEach((function(t){delete u[t]})):Object.assign(u,x)}return Object(n["l"])(Object.assign({},T,{$model:H,$dirty:$,$error:D,$errors:L,$invalid:I,$anyDirty:B,$pending:M,$touch:A,$reset:R,$path:h||b,$silentErrors:V},a&&{$getResultsForChild:F,$validate:P,$clearExternalResults:q},S))}var E=function(){function t(){o(this,t),this.storage=new Map}return r(t,[{key:"set",value:function(t,e,i){this.storage.set(t,{rules:e,result:i})}},{key:"checkRulesValidity",value:function(t,e,i){var s=Object.keys(i),o=Object.keys(e);if(o.length!==s.length)return!1;var a=o.every((function(t){return s.includes(t)}));return!!a&&o.every((function(t){return!e[t].$params||Object.keys(e[t].$params).every((function(s){return Object(n["n"])(i[t].$params[s])===Object(n["n"])(e[t].$params[s])}))}))}},{key:"get",value:function(t,e){var i=this.storage.get(t);if(i){var n=i.rules,s=i.result,o=this.checkRulesValidity(t,e,n),a=s.$unwatch?s.$unwatch:function(){return{}};return o?s:{$dirty:s.$dirty,$partial:!0,$unwatch:a}}}}]),t}(),$=Symbol("vuelidate#injectChiildResults"),L=Symbol("vuelidate#removeChiildResults"),I={COLLECT_ALL:!0,COLLECT_NONE:!1};function B(t){var e=t.$scope,i={},s=Object(n["m"])([]),o=Object(n["a"])((function(){return s.value.reduce((function(t,e){return t[e]=Object(n["n"])(i[e]),t}),{})}));function a(t,n){var o=n.$registerAs,a=n.$scope,r=n.$stopPropagation;r||e===I.COLLECT_NONE||a===I.COLLECT_NONE||e!==I.COLLECT_ALL&&e!==a||(i[o]=t,s.value.push(o))}function r(t){s.value=s.value.filter((function(e){return e!==t})),delete i[t]}var l=Object(n["c"])($,(function(){}));Object(n["k"])($,a);var d=Object(n["c"])(L,(function(){}));return Object(n["k"])(L,r),{childResults:o,sendValidationResultsToParent:l,removeValidationResultsFromParent:d}}function D(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};1===arguments.length&&(i=t,t=void 0,e=void 0);var o=i,a=o.$registerAs,r=o.$scope,l=void 0===r?I.COLLECT_ALL:r,d=o.$stopPropagation,c=o.$externalResults,u=Object(n["b"])(),h=u?n["g"]?u.type:u.proxy.$options:{};if(!a&&u){var p=u.uid||u._uid;a="_vuelidate_".concat(p)}var g=Object(n["m"])({}),v=new E,b=u?B({$scope:l}):{childResults:Object(n["m"])({})},w=b.childResults,y=b.sendValidationResultsToParent,_=b.removeValidationResultsFromParent;if(!t&&h.validations){var O=h.validations;e=Object(n["m"])({}),Object(n["i"])((function(){function t(e){return new Proxy(e,{get:function(e,i,o){return"object"===s(e[i])?t(e[i]):Object(n["a"])((function(){return e[i]}))}})}e.value=u.proxy,Object(n["o"])((function(){return f(O)?O.call(e.value,new t(e.value)):O}),(function(t){g.value=S({validations:t,state:e,childResults:w,resultsCache:v,globalConfig:i,instance:u.proxy,externalResults:u.proxy.vuelidateExternalResults})}),{immediate:!0})})),i=h.validationsConfig||{}}else{var x=Object(n["f"])(t)||m(t)?t:Object(n["l"])(t||{});Object(n["o"])(x,(function(t){g.value=S({validations:t,state:e,childResults:w,resultsCache:v,globalConfig:i,instance:u?u.proxy:{},externalResults:c})}),{immediate:!0})}return u&&(y(g,{$registerAs:a,$scope:l,$stopPropagation:d}),Object(n["j"])((function(){return _(a)}))),Object(n["a"])((function(){return Object.assign({},Object(n["n"])(g.value),w.value)}))}e["a"]=D},"3db7":function(t,e,i){},"41e3":function(t,e,i){"use strict";i("2209")},4238:function(t,e,i){},"52e1":function(t,e,i){!function(e,i){t.exports=i()}("undefined"!=typeof self&&self,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return n}));class n{constructor(t,e=null,i=null){this.events={},this.container=t,this.precanvas=null,this.nodeId=1,this.ele_selected=null,this.node_selected=null,this.drag=!1,this.reroute=!1,this.reroute_fix_curvature=!1,this.curvature=.5,this.reroute_curvature_start_end=.5,this.reroute_curvature=.5,this.reroute_width=6,this.drag_point=!1,this.editor_selected=!1,this.connection=!1,this.connection_ele=null,this.connection_selected=null,this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_x_start=0,this.pos_y=0,this.pos_y_start=0,this.mouse_x=0,this.mouse_y=0,this.line_path=5,this.first_click=null,this.force_first_input=!1,this.draggable_inputs=!0,this.useuuid=!1,this.parent=i,this.noderegister={},this.render=e,this.drawflow={drawflow:{Home:{data:{}}}},this.module="Home",this.editor_mode="edit",this.zoom=1,this.zoom_max=1.6,this.zoom_min=.5,this.zoom_value=.1,this.zoom_last_value=1,this.evCache=new Array,this.prevDiff=-1}start(){this.container.classList.add("parent-drawflow"),this.container.tabIndex=0,this.precanvas=document.createElement("div"),this.precanvas.classList.add("drawflow"),this.container.appendChild(this.precanvas),this.container.addEventListener("mouseup",this.dragEnd.bind(this)),this.container.addEventListener("mousemove",this.position.bind(this)),this.container.addEventListener("mousedown",this.click.bind(this)),this.container.addEventListener("touchend",this.dragEnd.bind(this)),this.container.addEventListener("touchmove",this.position.bind(this)),this.container.addEventListener("touchstart",this.click.bind(this)),this.container.addEventListener("contextmenu",this.contextmenu.bind(this)),this.container.addEventListener("keydown",this.key.bind(this)),this.container.addEventListener("wheel",this.zoom_enter.bind(this)),this.container.addEventListener("input",this.updateNodeValue.bind(this)),this.container.addEventListener("dblclick",this.dblclick.bind(this)),this.container.onpointerdown=this.pointerdown_handler.bind(this),this.container.onpointermove=this.pointermove_handler.bind(this),this.container.onpointerup=this.pointerup_handler.bind(this),this.container.onpointercancel=this.pointerup_handler.bind(this),this.container.onpointerout=this.pointerup_handler.bind(this),this.container.onpointerleave=this.pointerup_handler.bind(this),this.load()}pointerdown_handler(t){this.evCache.push(t)}pointermove_handler(t){for(var e=0;e<this.evCache.length;e++)if(t.pointerId==this.evCache[e].pointerId){this.evCache[e]=t;break}if(2==this.evCache.length){var i=Math.abs(this.evCache[0].clientX-this.evCache[1].clientX);this.prevDiff>100&&(i>this.prevDiff&&this.zoom_in(),i<this.prevDiff&&this.zoom_out()),this.prevDiff=i}}pointerup_handler(t){this.remove_event(t),this.evCache.length<2&&(this.prevDiff=-1)}remove_event(t){for(var e=0;e<this.evCache.length;e++)if(this.evCache[e].pointerId==t.pointerId){this.evCache.splice(e,1);break}}load(){for(var t in this.drawflow.drawflow[this.module].data)this.addNodeImport(this.drawflow.drawflow[this.module].data[t],this.precanvas);if(this.reroute)for(var t in this.drawflow.drawflow[this.module].data)this.addRerouteImport(this.drawflow.drawflow[this.module].data[t]);for(var t in this.drawflow.drawflow[this.module].data)this.updateConnectionNodes("node-"+t);const e=this.drawflow.drawflow;let i=1;Object.keys(e).map((function(t,n){Object.keys(e[t].data).map((function(t,e){parseInt(t)>=i&&(i=parseInt(t)+1)}))})),this.nodeId=i}removeReouteConnectionSelected(){this.dispatch("connectionUnselected",!0),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,e)=>{t.classList.remove("selected")})}click(t){if(this.dispatch("click",t),"fixed"===this.editor_mode){if("parent-drawflow"!==t.target.classList[0]&&"drawflow"!==t.target.classList[0])return!1;this.ele_selected=t.target.closest(".parent-drawflow")}else"view"===this.editor_mode?(null!=t.target.closest(".drawflow")||t.target.matches(".parent-drawflow"))&&(this.ele_selected=t.target.closest(".parent-drawflow"),t.preventDefault()):(this.first_click=t.target,this.ele_selected=t.target,0===t.button&&this.contextmenuDel(),null!=t.target.closest(".drawflow_content_node")&&(this.ele_selected=t.target.closest(".drawflow_content_node").parentElement));switch(this.ele_selected.classList[0]){case"drawflow-node":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected!=this.ele_selected&&this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.node_selected!=this.ele_selected&&this.dispatch("nodeSelected",this.ele_selected.id.slice(5)),this.node_selected=this.ele_selected,this.node_selected.classList.add("selected"),this.draggable_inputs?"SELECT"!==t.target.tagName&&(this.drag=!0):"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&"SELECT"!==t.target.tagName&&!0!==t.target.hasAttribute("contenteditable")&&(this.drag=!0);break;case"output":this.connection=!0,null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.drawConnection(t.target);break;case"parent-drawflow":case"drawflow":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.editor_selected=!0;break;case"main-path":null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null),this.connection_selected=this.ele_selected,this.connection_selected.classList.add("selected");const e=this.connection_selected.parentElement.classList;this.dispatch("connectionSelected",{output_id:e[2].slice(14),input_id:e[1].slice(13),output_class:e[3],input_class:e[4]}),this.reroute_fix_curvature&&this.connection_selected.parentElement.querySelectorAll(".main-path").forEach((t,e)=>{t.classList.add("selected")});break;case"point":this.drag_point=!0,this.ele_selected.classList.add("selected");break;case"drawflow-delete":this.node_selected&&this.removeNodeId(this.node_selected.id),this.connection_selected&&this.removeConnection(),null!=this.node_selected&&(this.node_selected.classList.remove("selected"),this.node_selected=null,this.dispatch("nodeUnselected",!0)),null!=this.connection_selected&&(this.connection_selected.classList.remove("selected"),this.removeReouteConnectionSelected(),this.connection_selected=null)}"touchstart"===t.type?(this.pos_x=t.touches[0].clientX,this.pos_x_start=t.touches[0].clientX,this.pos_y=t.touches[0].clientY,this.pos_y_start=t.touches[0].clientY):(this.pos_x=t.clientX,this.pos_x_start=t.clientX,this.pos_y=t.clientY,this.pos_y_start=t.clientY),this.dispatch("clickEnd",t)}position(t){if("touchmove"===t.type)var e=t.touches[0].clientX,i=t.touches[0].clientY;else e=t.clientX,i=t.clientY;if(this.connection&&this.updateConnection(e,i),this.editor_selected&&(n=this.canvas_x+-(this.pos_x-e),s=this.canvas_y+-(this.pos_y-i),this.dispatch("translate",{x:n,y:s}),this.precanvas.style.transform="translate("+n+"px, "+s+"px) scale("+this.zoom+")"),this.drag){var n=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),s=(this.pos_y-i)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom);this.pos_x=e,this.pos_y=i,this.ele_selected.style.top=this.ele_selected.offsetTop-s+"px",this.ele_selected.style.left=this.ele_selected.offsetLeft-n+"px",this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_x=this.ele_selected.offsetLeft-n,this.drawflow.drawflow[this.module].data[this.ele_selected.id.slice(5)].pos_y=this.ele_selected.offsetTop-s,this.updateConnectionNodes(this.ele_selected.id)}if(this.drag_point){n=(this.pos_x-e)*this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom),s=(this.pos_y-i)*this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom),this.pos_x=e,this.pos_y=i;var o=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),a=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));this.ele_selected.setAttributeNS(null,"cx",o),this.ele_selected.setAttributeNS(null,"cy",a);const t=this.ele_selected.parentElement.classList[2].slice(9),r=this.ele_selected.parentElement.classList[1].slice(13),l=this.ele_selected.parentElement.classList[3],d=this.ele_selected.parentElement.classList[4];let c=Array.from(this.ele_selected.parentElement.children).indexOf(this.ele_selected)-1;this.reroute_fix_curvature&&(c-=this.ele_selected.parentElement.querySelectorAll(".main-path").length-1,c<0&&(c=0));const u=t.slice(5),h=this.drawflow.drawflow[this.module].data[u].outputs[l].connections.findIndex((function(t,e){return t.node===r&&t.output===d}));this.drawflow.drawflow[this.module].data[u].outputs[l].connections[h].points[c]={pos_x:o,pos_y:a};const p=this.ele_selected.parentElement.classList[2].slice(9);this.updateConnectionNodes(p)}"touchmove"===t.type&&(this.mouse_x=e,this.mouse_y=i),this.dispatch("mouseMove",{x:e,y:i})}dragEnd(t){if("touchend"===t.type)var e=this.mouse_x,i=this.mouse_y,n=document.elementFromPoint(e,i);else e=t.clientX,i=t.clientY,n=t.target;if(this.drag&&(this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("nodeMoved",this.ele_selected.id.slice(5))),this.drag_point&&(this.ele_selected.classList.remove("selected"),this.pos_x_start==e&&this.pos_y_start==i||this.dispatch("rerouteMoved",this.ele_selected.parentElement.classList[2].slice(14))),this.editor_selected&&(this.canvas_x=this.canvas_x+-(this.pos_x-e),this.canvas_y=this.canvas_y+-(this.pos_y-i),this.editor_selected=!1),!0===this.connection)if("input"===n.classList[0]||this.force_first_input&&(null!=n.closest(".drawflow_content_node")||"drawflow-node"===n.classList[0])){if(!this.force_first_input||null==n.closest(".drawflow_content_node")&&"drawflow-node"!==n.classList[0])s=n.parentElement.parentElement.id,o=n.classList[1];else{if(null!=n.closest(".drawflow_content_node"))var s=n.closest(".drawflow_content_node").parentElement.id;else s=n.id;if(0===Object.keys(this.getNodeFromId(s.slice(5)).inputs).length)var o=!1;else o="input_1"}var a=this.ele_selected.parentElement.parentElement.id,r=this.ele_selected.classList[1];if(a!==s&&!1!==o){if(0===this.container.querySelectorAll(".connection.node_in_"+s+".node_out_"+a+"."+r+"."+o).length){this.connection_ele.classList.add("node_in_"+s),this.connection_ele.classList.add("node_out_"+a),this.connection_ele.classList.add(r),this.connection_ele.classList.add(o);var l=s.slice(5),d=a.slice(5);this.drawflow.drawflow[this.module].data[d].outputs[r].connections.push({node:l,output:o}),this.drawflow.drawflow[this.module].data[l].inputs[o].connections.push({node:d,input:r}),this.updateConnectionNodes("node-"+d),this.updateConnectionNodes("node-"+l),this.dispatch("connectionCreated",{output_id:d,input_id:l,output_class:r,input_class:o})}else this.dispatch("connectionCancel",!0),this.connection_ele.remove();this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null}else this.dispatch("connectionCancel",!0),this.connection_ele.remove(),this.connection_ele=null;this.drag=!1,this.drag_point=!1,this.connection=!1,this.ele_selected=null,this.editor_selected=!1,this.dispatch("mouseUp",t)}contextmenu(t){if(this.dispatch("contextmenu",t),t.preventDefault(),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;if(this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove(),this.node_selected||this.connection_selected){var e=document.createElement("div");e.classList.add("drawflow-delete"),e.innerHTML="x",this.node_selected&&this.node_selected.appendChild(e),this.connection_selected&&(e.style.top=t.clientY*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))+"px",e.style.left=t.clientX*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))+"px",this.precanvas.appendChild(e))}}contextmenuDel(){this.precanvas.getElementsByClassName("drawflow-delete").length&&this.precanvas.getElementsByClassName("drawflow-delete")[0].remove()}key(t){if(this.dispatch("keydown",t),"fixed"===this.editor_mode||"view"===this.editor_mode)return!1;("Delete"===t.key||"Backspace"===t.key&&t.metaKey)&&(null!=this.node_selected&&"INPUT"!==this.first_click.tagName&&"TEXTAREA"!==this.first_click.tagName&&!0!==this.first_click.hasAttribute("contenteditable")&&this.removeNodeId(this.node_selected.id),null!=this.connection_selected&&this.removeConnection())}zoom_enter(t,e){t.ctrlKey&&(t.preventDefault(),t.deltaY>0?this.zoom_out():this.zoom_in())}zoom_refresh(){this.dispatch("zoom",this.zoom),this.canvas_x=this.canvas_x/this.zoom_last_value*this.zoom,this.canvas_y=this.canvas_y/this.zoom_last_value*this.zoom,this.zoom_last_value=this.zoom,this.precanvas.style.transform="translate("+this.canvas_x+"px, "+this.canvas_y+"px) scale("+this.zoom+")"}zoom_in(){this.zoom<this.zoom_max&&(this.zoom+=this.zoom_value,this.zoom_refresh())}zoom_out(){this.zoom>this.zoom_min&&(this.zoom-=this.zoom_value,this.zoom_refresh())}zoom_reset(){1!=this.zoom&&(this.zoom=1,this.zoom_refresh())}createCurvature(t,e,i,n,s,o){var a=t,r=e,l=i,d=n,c=s;switch(o){case"open":if(t>=i)var u=a+Math.abs(l-a)*c,h=l-Math.abs(l-a)*(-1*c);else u=a+Math.abs(l-a)*c,h=l-Math.abs(l-a)*c;return" M "+a+" "+r+" C "+u+" "+r+" "+h+" "+d+" "+l+"  "+d;case"close":return t>=i?(u=a+Math.abs(l-a)*(-1*c),h=l-Math.abs(l-a)*c):(u=a+Math.abs(l-a)*c,h=l-Math.abs(l-a)*c)," M "+a+" "+r+" C "+u+" "+r+" "+h+" "+d+" "+l+"  "+d;case"other":return t>=i?(u=a+Math.abs(l-a)*(-1*c),h=l-Math.abs(l-a)*(-1*c)):(u=a+Math.abs(l-a)*c,h=l-Math.abs(l-a)*c)," M "+a+" "+r+" C "+u+" "+r+" "+h+" "+d+" "+l+"  "+d;default:return" M "+a+" "+r+" C "+(u=a+Math.abs(l-a)*c)+" "+r+" "+(h=l-Math.abs(l-a)*c)+" "+d+" "+l+"  "+d}}drawConnection(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this.connection_ele=e;var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.classList.add("main-path"),i.setAttributeNS(null,"d",""),e.classList.add("connection"),e.appendChild(i),this.precanvas.appendChild(e);var n=t.parentElement.parentElement.id.slice(5),s=t.classList[1];this.dispatch("connectionStart",{output_id:n,output_class:s})}updateConnection(t,e){const i=this.precanvas,n=this.zoom;let s=i.clientWidth/(i.clientWidth*n);s=s||0;let o=i.clientHeight/(i.clientHeight*n);o=o||0;var a=this.connection_ele.children[0],r=this.ele_selected.offsetWidth/2+(this.ele_selected.getBoundingClientRect().x-i.getBoundingClientRect().x)*s,l=this.ele_selected.offsetHeight/2+(this.ele_selected.getBoundingClientRect().y-i.getBoundingClientRect().y)*o,d=t*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),c=e*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom)),u=this.curvature,h=this.createCurvature(r,l,d,c,u,"openclose");a.setAttributeNS(null,"d",h)}addConnection(t,e,i,n){var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(e)){var o=this.getNodeFromId(t),a=!1;for(var r in o.outputs[i].connections){var l=o.outputs[i].connections[r];l.node==e&&l.output==n&&(a=!0)}if(!1===a){if(this.drawflow.drawflow[s].data[t].outputs[i].connections.push({node:e.toString(),output:n}),this.drawflow.drawflow[s].data[e].inputs[n].connections.push({node:t.toString(),input:i}),this.module===s){var d=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.classList.add("main-path"),c.setAttributeNS(null,"d",""),d.classList.add("connection"),d.classList.add("node_in_node-"+e),d.classList.add("node_out_node-"+t),d.classList.add(i),d.classList.add(n),d.appendChild(c),this.precanvas.appendChild(d),this.updateConnectionNodes("node-"+t),this.updateConnectionNodes("node-"+e)}this.dispatch("connectionCreated",{output_id:t,input_id:e,output_class:i,input_class:n})}}}updateConnectionNodes(t){const e="node_in_"+t,i="node_out_"+t;this.line_path;const n=this.container,s=this.precanvas,o=this.curvature,a=this.createCurvature,r=this.reroute_curvature,l=this.reroute_curvature_start_end,d=this.reroute_fix_curvature,c=this.reroute_width,u=this.zoom;let h=s.clientWidth/(s.clientWidth*u);h=h||0;let p=s.clientHeight/(s.clientHeight*u);p=p||0;const g=n.querySelectorAll("."+i);Object.keys(g).map((function(e,i){if(null===g[e].querySelector(".point")){var f=n.querySelector("#"+t),m=g[e].classList[1].replace("node_in_",""),v=n.querySelector("#"+m).querySelectorAll("."+g[e].classList[4])[0],b=v.offsetWidth/2+(v.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,w=v.offsetHeight/2+(v.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,y=f.querySelectorAll("."+g[e].classList[3])[0],_=y.offsetWidth/2+(y.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,O=y.offsetHeight/2+(y.getBoundingClientRect().y-s.getBoundingClientRect().y)*p;const i=a(_,O,b,w,o,"openclose");g[e].children[0].setAttributeNS(null,"d",i)}else{const i=g[e].querySelectorAll(".point");let o="";const f=[];i.forEach((e,d)=>{if(0===d&&i.length-1==0){var g=n.querySelector("#"+t),m=((O=e).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,v=(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,b=(x=g.querySelectorAll("."+e.parentElement.classList[3])[0]).offsetWidth/2+(x.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,w=x.offsetHeight/2+(x.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,y=a(b,w,m,v,l,"open");o+=y,f.push(y),g=e;var _=e.parentElement.classList[1].replace("node_in_",""),O=(C=n.querySelector("#"+_)).querySelectorAll("."+e.parentElement.classList[4])[0];m=(T=C.querySelectorAll("."+e.parentElement.classList[4])[0]).offsetWidth/2+(T.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,v=T.offsetHeight/2+(T.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,b=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,w=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,y=a(b,w,m,v,l,"close"),o+=y,f.push(y)}else if(0===d){var x;g=n.querySelector("#"+t),m=((O=e).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,v=(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,b=(x=g.querySelectorAll("."+e.parentElement.classList[3])[0]).offsetWidth/2+(x.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,w=x.offsetHeight/2+(x.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,y=a(b,w,m,v,l,"open"),o+=y,f.push(y),g=e,m=((O=i[d+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,v=(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,b=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,w=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,y=a(b,w,m,v,r,"other"),o+=y,f.push(y)}else if(d===i.length-1){var C,T;g=e,_=e.parentElement.classList[1].replace("node_in_",""),O=(C=n.querySelector("#"+_)).querySelectorAll("."+e.parentElement.classList[4])[0],m=(T=C.querySelectorAll("."+e.parentElement.classList[4])[0]).offsetWidth/2+(T.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,v=T.offsetHeight/2+(T.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,b=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*u))+c,w=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*u))+c,y=a(b,w,m,v,l,"close"),o+=y,f.push(y)}else g=e,m=((O=i[d+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*u))+c,v=(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*u))+c,b=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*(s.clientWidth/(s.clientWidth*u))+c,w=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*(s.clientHeight/(s.clientHeight*u))+c,y=a(b,w,m,v,r,"other"),o+=y,f.push(y)}),d?f.forEach((t,i)=>{g[e].children[i].setAttributeNS(null,"d",t)}):g[e].children[0].setAttributeNS(null,"d",o)}}));const f=n.querySelectorAll("."+e);Object.keys(f).map((function(e,i){if(null===f[e].querySelector(".point")){var u=n.querySelector("#"+t),g=f[e].classList[2].replace("node_out_",""),m=n.querySelector("#"+g).querySelectorAll("."+f[e].classList[3])[0],v=m.offsetWidth/2+(m.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,b=m.offsetHeight/2+(m.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,w=(u=u.querySelectorAll("."+f[e].classList[4])[0]).offsetWidth/2+(u.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,y=u.offsetHeight/2+(u.getBoundingClientRect().y-s.getBoundingClientRect().y)*p;const i=a(v,b,w,y,o,"openclose");f[e].children[0].setAttributeNS(null,"d",i)}else{const i=f[e].querySelectorAll(".point");let o="";const u=[];i.forEach((e,d)=>{if(0===d&&i.length-1==0){var g=n.querySelector("#"+t),f=((_=e).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,m=(_.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,v=(C=g.querySelectorAll("."+e.parentElement.classList[4])[0]).offsetWidth/2+(C.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,b=C.offsetHeight/2+(C.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,w=a(f,m,v,b,l,"close");o+=w,u.push(w),g=e;var y=e.parentElement.classList[2].replace("node_out_",""),_=(x=n.querySelector("#"+y)).querySelectorAll("."+e.parentElement.classList[3])[0];f=(O=x.querySelectorAll("."+e.parentElement.classList[3])[0]).offsetWidth/2+(O.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,m=O.offsetHeight/2+(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,v=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,b=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,w=a(f,m,v,b,l,"open"),o+=w,u.push(w)}else if(0===d){var O;g=e,y=e.parentElement.classList[2].replace("node_out_",""),_=(x=n.querySelector("#"+y)).querySelectorAll("."+e.parentElement.classList[3])[0],f=(O=x.querySelectorAll("."+e.parentElement.classList[3])[0]).offsetWidth/2+(O.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,m=O.offsetHeight/2+(O.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,v=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,b=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,w=a(f,m,v,b,l,"open"),o+=w,u.push(w),g=e,v=((_=i[d+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,b=(_.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,f=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,m=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,w=a(f,m,v,b,r,"other"),o+=w,u.push(w)}else if(d===i.length-1){var x,C;g=e,y=e.parentElement.classList[1].replace("node_in_",""),_=(x=n.querySelector("#"+y)).querySelectorAll("."+e.parentElement.classList[4])[0],v=(C=x.querySelectorAll("."+e.parentElement.classList[4])[0]).offsetWidth/2+(C.getBoundingClientRect().x-s.getBoundingClientRect().x)*h,b=C.offsetHeight/2+(C.getBoundingClientRect().y-s.getBoundingClientRect().y)*p,f=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,m=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,w=a(f,m,v,b,l,"close"),o+=w,u.push(w)}else g=e,v=((_=i[d+1]).getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,b=(_.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,f=(g.getBoundingClientRect().x-s.getBoundingClientRect().x)*h+c,m=(g.getBoundingClientRect().y-s.getBoundingClientRect().y)*p+c,w=a(f,m,v,b,r,"other"),o+=w,u.push(w)}),d?u.forEach((t,i)=>{f[e].children[i].setAttributeNS(null,"d",t)}):f[e].children[0].setAttributeNS(null,"d",o)}}))}dblclick(t){null!=this.connection_selected&&this.reroute&&this.createReroutePoint(this.connection_selected),"point"===t.target.classList[0]&&this.removeReroutePoint(t.target)}createReroutePoint(t){this.connection_selected.classList.remove("selected");const e=this.connection_selected.parentElement.classList[2].slice(9),i=this.connection_selected.parentElement.classList[1].slice(13),n=this.connection_selected.parentElement.classList[3],s=this.connection_selected.parentElement.classList[4];this.connection_selected=null;const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.classList.add("point");var a=this.pos_x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom))-this.precanvas.getBoundingClientRect().x*(this.precanvas.clientWidth/(this.precanvas.clientWidth*this.zoom)),r=this.pos_y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom))-this.precanvas.getBoundingClientRect().y*(this.precanvas.clientHeight/(this.precanvas.clientHeight*this.zoom));o.setAttributeNS(null,"cx",a),o.setAttributeNS(null,"cy",r),o.setAttributeNS(null,"r",this.reroute_width);let l=0;if(this.reroute_fix_curvature){const e=t.parentElement.querySelectorAll(".main-path").length;var d=document.createElementNS("http://www.w3.org/2000/svg","path");if(d.classList.add("main-path"),d.setAttributeNS(null,"d",""),t.parentElement.insertBefore(d,t.parentElement.children[e]),1===e)t.parentElement.appendChild(o);else{const i=Array.from(t.parentElement.children).indexOf(t);l=i,t.parentElement.insertBefore(o,t.parentElement.children[i+e+1])}}else t.parentElement.appendChild(o);const c=e.slice(5),u=this.drawflow.drawflow[this.module].data[c].outputs[n].connections.findIndex((function(t,e){return t.node===i&&t.output===s}));void 0===this.drawflow.drawflow[this.module].data[c].outputs[n].connections[u].points&&(this.drawflow.drawflow[this.module].data[c].outputs[n].connections[u].points=[]),this.reroute_fix_curvature?(l>0?this.drawflow.drawflow[this.module].data[c].outputs[n].connections[u].points.splice(l,0,{pos_x:a,pos_y:r}):this.drawflow.drawflow[this.module].data[c].outputs[n].connections[u].points.push({pos_x:a,pos_y:r}),t.parentElement.querySelectorAll(".main-path").forEach((t,e)=>{t.classList.remove("selected")})):this.drawflow.drawflow[this.module].data[c].outputs[n].connections[u].points.push({pos_x:a,pos_y:r}),this.dispatch("addReroute",c),this.updateConnectionNodes(e)}removeReroutePoint(t){const e=t.parentElement.classList[2].slice(9),i=t.parentElement.classList[1].slice(13),n=t.parentElement.classList[3],s=t.parentElement.classList[4];let o=Array.from(t.parentElement.children).indexOf(t)-1;const a=e.slice(5),r=this.drawflow.drawflow[this.module].data[a].outputs[n].connections.findIndex((function(t,e){return t.node===i&&t.output===s}));if(this.reroute_fix_curvature){const e=t.parentElement.querySelectorAll(".main-path").length;t.parentElement.children[e-1].remove(),o-=e,o<0&&(o=0)}this.drawflow.drawflow[this.module].data[a].outputs[n].connections[r].points.splice(o,1),t.remove(),this.dispatch("removeReroute",a),this.updateConnectionNodes(e)}registerNode(t,e,i=null,n=null){this.noderegister[t]={html:e,props:i,options:n}}getNodeFromId(t){var e=this.getModuleFromNodeId(t);return JSON.parse(JSON.stringify(this.drawflow.drawflow[e].data[t]))}getNodesFromName(t){var e=[];const i=this.drawflow.drawflow;return Object.keys(i).map((function(n,s){for(var o in i[n].data)i[n].data[o].name==t&&e.push(i[n].data[o].id)})),e}addNode(t,e,i,n,s,o,a,r,l=!1){if(this.useuuid)var d=this.getUuid();else d=this.nodeId;const c=document.createElement("div");c.classList.add("parent-node");const u=document.createElement("div");u.innerHTML="",u.setAttribute("id","node-"+d),u.classList.add("drawflow-node"),""!=o&&u.classList.add(o);const h=document.createElement("div");h.classList.add("inputs");const p=document.createElement("div");p.classList.add("outputs");const g={};for(var f=0;f<e;f++){const t=document.createElement("div");t.classList.add("input"),t.classList.add("input_"+(f+1)),g["input_"+(f+1)]={connections:[]},h.appendChild(t)}const m={};for(f=0;f<i;f++){const t=document.createElement("div");t.classList.add("output"),t.classList.add("output_"+(f+1)),m["output_"+(f+1)]={connections:[]},p.appendChild(t)}const v=document.createElement("div");if(v.classList.add("drawflow_content_node"),!1===l)v.innerHTML=r;else if(!0===l)v.appendChild(this.noderegister[r].html.cloneNode(!0));else if(3===parseInt(this.render.version)){let t=this.render.h(this.noderegister[r].html,this.noderegister[r].props,this.noderegister[r].options);t.appContext=this.parent,this.render.render(t,v)}else{let t=new this.render({parent:this.parent,render:t=>t(this.noderegister[r].html,{props:this.noderegister[r].props}),...this.noderegister[r].options}).$mount();v.appendChild(t.$el)}Object.entries(a).forEach((function(t,e){if("object"==typeof t[1])!function t(e,i,n){e=null===e?a[i]:e[i],null!==e&&Object.entries(e).forEach((function(i,s){if("object"==typeof i[1])t(e,i[0],n+"-"+i[0]);else for(var o=v.querySelectorAll("[df-"+n+"-"+i[0]+"]"),a=0;a<o.length;a++)o[a].value=i[1],o[a].isContentEditable&&(o[a].innerText=i[1])}))}(null,t[0],t[0]);else for(var i=v.querySelectorAll("[df-"+t[0]+"]"),n=0;n<i.length;n++)i[n].value=t[1],i[n].isContentEditable&&(i[n].innerText=t[1])})),u.appendChild(h),u.appendChild(v),u.appendChild(p),u.style.top=s+"px",u.style.left=n+"px",c.appendChild(u),this.precanvas.appendChild(c);var b={id:d,name:t,data:a,class:o,html:r,typenode:l,inputs:g,outputs:m,pos_x:n,pos_y:s};return this.drawflow.drawflow[this.module].data[d]=b,this.dispatch("nodeCreated",d),this.useuuid||this.nodeId++,d}addNodeImport(t,e){const i=document.createElement("div");i.classList.add("parent-node");const n=document.createElement("div");n.innerHTML="",n.setAttribute("id","node-"+t.id),n.classList.add("drawflow-node"),""!=t.class&&n.classList.add(t.class);const s=document.createElement("div");s.classList.add("inputs");const o=document.createElement("div");o.classList.add("outputs"),Object.keys(t.inputs).map((function(i,n){const o=document.createElement("div");o.classList.add("input"),o.classList.add(i),s.appendChild(o),Object.keys(t.inputs[i].connections).map((function(n,s){var o=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.classList.add("main-path"),a.setAttributeNS(null,"d",""),o.classList.add("connection"),o.classList.add("node_in_node-"+t.id),o.classList.add("node_out_node-"+t.inputs[i].connections[n].node),o.classList.add(t.inputs[i].connections[n].input),o.classList.add(i),o.appendChild(a),e.appendChild(o)}))}));for(var a=0;a<Object.keys(t.outputs).length;a++){const t=document.createElement("div");t.classList.add("output"),t.classList.add("output_"+(a+1)),o.appendChild(t)}const r=document.createElement("div");if(r.classList.add("drawflow_content_node"),!1===t.typenode)r.innerHTML=t.html;else if(!0===t.typenode)r.appendChild(this.noderegister[t.html].html.cloneNode(!0));else if(3===parseInt(this.render.version)){let e=this.render.h(this.noderegister[t.html].html,this.noderegister[t.html].props,this.noderegister[t.html].options);e.appContext=this.parent,this.render.render(e,r)}else{let e=new this.render({parent:this.parent,render:e=>e(this.noderegister[t.html].html,{props:this.noderegister[t.html].props}),...this.noderegister[t.html].options}).$mount();r.appendChild(e.$el)}Object.entries(t.data).forEach((function(e,i){if("object"==typeof e[1])!function e(i,n,s){i=null===i?t.data[n]:i[n],null!==i&&Object.entries(i).forEach((function(t,n){if("object"==typeof t[1])e(i,t[0],s+"-"+t[0]);else for(var o=r.querySelectorAll("[df-"+s+"-"+t[0]+"]"),a=0;a<o.length;a++)o[a].value=t[1],o[a].isContentEditable&&(o[a].innerText=t[1])}))}(null,e[0],e[0]);else for(var n=r.querySelectorAll("[df-"+e[0]+"]"),s=0;s<n.length;s++)n[s].value=e[1],n[s].isContentEditable&&(n[s].innerText=e[1])})),n.appendChild(s),n.appendChild(r),n.appendChild(o),n.style.top=t.pos_y+"px",n.style.left=t.pos_x+"px",i.appendChild(n),this.precanvas.appendChild(i)}addRerouteImport(t){const e=this.reroute_width,i=this.reroute_fix_curvature,n=this.container;Object.keys(t.outputs).map((function(s,o){Object.keys(t.outputs[s].connections).map((function(o,a){const r=t.outputs[s].connections[o].points;void 0!==r&&r.forEach((a,l)=>{const d=t.outputs[s].connections[o].node,c=t.outputs[s].connections[o].output,u=n.querySelector(".connection.node_in_node-"+d+".node_out_node-"+t.id+"."+s+"."+c);if(i&&0===l)for(var h=0;h<r.length;h++){var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.classList.add("main-path"),p.setAttributeNS(null,"d",""),u.appendChild(p)}const g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.classList.add("point");var f=a.pos_x,m=a.pos_y;g.setAttributeNS(null,"cx",f),g.setAttributeNS(null,"cy",m),g.setAttributeNS(null,"r",e),u.appendChild(g)})}))}))}updateNodeValue(t){for(var e=t.target.attributes,i=0;i<e.length;i++)if(e[i].nodeName.startsWith("df-")){for(var n=e[i].nodeName.slice(3).split("-"),s=this.drawflow.drawflow[this.module].data[t.target.closest(".drawflow_content_node").parentElement.id.slice(5)].data,o=0;o<n.length-1;o+=1)null==s[n[o]]&&(s[n[o]]={}),s=s[n[o]];s[n[n.length-1]]=t.target.value,t.target.isContentEditable&&(s[n[n.length-1]]=t.target.innerText),this.dispatch("nodeDataChanged",t.target.closest(".drawflow_content_node").parentElement.id.slice(5))}}updateNodeDataFromId(t,e){var i=this.getModuleFromNodeId(t);if(this.drawflow.drawflow[i].data[t].data=e,this.module===i){const i=this.container.querySelector("#node-"+t);Object.entries(e).forEach((function(t,n){if("object"==typeof t[1])!function t(n,s,o){n=null===n?e[s]:n[s],null!==n&&Object.entries(n).forEach((function(e,s){if("object"==typeof e[1])t(n,e[0],o+"-"+e[0]);else for(var a=i.querySelectorAll("[df-"+o+"-"+e[0]+"]"),r=0;r<a.length;r++)a[r].value=e[1],a[r].isContentEditable&&(a[r].innerText=e[1])}))}(null,t[0],t[0]);else for(var s=i.querySelectorAll("[df-"+t[0]+"]"),o=0;o<s.length;o++)s[o].value=t[1],s[o].isContentEditable&&(s[o].innerText=t[1])}))}}addNodeInput(t){var e=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t),n=Object.keys(i.inputs).length;if(this.module===e){const e=document.createElement("div");e.classList.add("input"),e.classList.add("input_"+(n+1)),this.container.querySelector("#node-"+t+" .inputs").appendChild(e),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].inputs["input_"+(n+1)]={connections:[]}}addNodeOutput(t){var e=this.getModuleFromNodeId(t);const i=this.getNodeFromId(t),n=Object.keys(i.outputs).length;if(this.module===e){const e=document.createElement("div");e.classList.add("output"),e.classList.add("output_"+(n+1)),this.container.querySelector("#node-"+t+" .outputs").appendChild(e),this.updateConnectionNodes("node-"+t)}this.drawflow.drawflow[e].data[t].outputs["output_"+(n+1)]={connections:[]}}removeNodeInput(t,e){var i=this.getModuleFromNodeId(t);const n=this.getNodeFromId(t);this.module===i&&this.container.querySelector("#node-"+t+" .inputs .input."+e).remove();const s=[];Object.keys(n.inputs[e].connections).map((function(i,o){const a=n.inputs[e].connections[o].node,r=n.inputs[e].connections[o].input;s.push({id_output:a,id:t,output_class:r,input_class:e})})),s.forEach((t,e)=>{this.removeSingleConnection(t.id_output,t.id,t.output_class,t.input_class)}),delete this.drawflow.drawflow[i].data[t].inputs[e];const o=[],a=this.drawflow.drawflow[i].data[t].inputs;Object.keys(a).map((function(t,e){o.push(a[t])})),this.drawflow.drawflow[i].data[t].inputs={};const r=e.slice(6);let l=[];o.forEach((e,n)=>{e.connections.forEach((t,e)=>{l.push(t)}),this.drawflow.drawflow[i].data[t].inputs["input_"+(n+1)]=e}),l=new Set(l.map(t=>JSON.stringify(t))),l=Array.from(l).map(t=>JSON.parse(t)),this.module===i&&this.container.querySelectorAll("#node-"+t+" .inputs .input").forEach((t,e)=>{const i=t.classList[1].slice(6);parseInt(r)<parseInt(i)&&(t.classList.remove("input_"+i),t.classList.add("input_"+(i-1)))}),l.forEach((e,n)=>{this.drawflow.drawflow[i].data[e.node].outputs[e.input].connections.forEach((n,s)=>{if(n.node==t){const o=n.output.slice(6);if(parseInt(r)<parseInt(o)){if(this.module===i){const i=this.container.querySelector(".connection.node_in_node-"+t+".node_out_node-"+e.node+"."+e.input+".input_"+o);i.classList.remove("input_"+o),i.classList.add("input_"+(o-1))}n.points?this.drawflow.drawflow[i].data[e.node].outputs[e.input].connections[s]={node:n.node,output:"input_"+(o-1),points:n.points}:this.drawflow.drawflow[i].data[e.node].outputs[e.input].connections[s]={node:n.node,output:"input_"+(o-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeOutput(t,e){var i=this.getModuleFromNodeId(t);const n=this.getNodeFromId(t);this.module===i&&this.container.querySelector("#node-"+t+" .outputs .output."+e).remove();const s=[];Object.keys(n.outputs[e].connections).map((function(i,o){const a=n.outputs[e].connections[o].node,r=n.outputs[e].connections[o].output;s.push({id:t,id_input:a,output_class:e,input_class:r})})),s.forEach((t,e)=>{this.removeSingleConnection(t.id,t.id_input,t.output_class,t.input_class)}),delete this.drawflow.drawflow[i].data[t].outputs[e];const o=[],a=this.drawflow.drawflow[i].data[t].outputs;Object.keys(a).map((function(t,e){o.push(a[t])})),this.drawflow.drawflow[i].data[t].outputs={};const r=e.slice(7);let l=[];o.forEach((e,n)=>{e.connections.forEach((t,e)=>{l.push({node:t.node,output:t.output})}),this.drawflow.drawflow[i].data[t].outputs["output_"+(n+1)]=e}),l=new Set(l.map(t=>JSON.stringify(t))),l=Array.from(l).map(t=>JSON.parse(t)),this.module===i&&this.container.querySelectorAll("#node-"+t+" .outputs .output").forEach((t,e)=>{const i=t.classList[1].slice(7);parseInt(r)<parseInt(i)&&(t.classList.remove("output_"+i),t.classList.add("output_"+(i-1)))}),l.forEach((e,n)=>{this.drawflow.drawflow[i].data[e.node].inputs[e.output].connections.forEach((n,s)=>{if(n.node==t){const o=n.input.slice(7);if(parseInt(r)<parseInt(o)){if(this.module===i){const i=this.container.querySelector(".connection.node_in_node-"+e.node+".node_out_node-"+t+".output_"+o+"."+e.output);i.classList.remove("output_"+o),i.classList.remove(e.output),i.classList.add("output_"+(o-1)),i.classList.add(e.output)}n.points?this.drawflow.drawflow[i].data[e.node].inputs[e.output].connections[s]={node:n.node,input:"output_"+(o-1),points:n.points}:this.drawflow.drawflow[i].data[e.node].inputs[e.output].connections[s]={node:n.node,input:"output_"+(o-1)}}}})}),this.updateConnectionNodes("node-"+t)}removeNodeId(t){this.removeConnectionNodeId(t);var e=this.getModuleFromNodeId(t.slice(5));this.module===e&&this.container.querySelector("#"+t).remove(),delete this.drawflow.drawflow[e].data[t.slice(5)],this.dispatch("nodeRemoved",t.slice(5))}removeConnection(){if(null!=this.connection_selected){var t=this.connection_selected.parentElement.classList;this.connection_selected.parentElement.remove();var e=this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.findIndex((function(e,i){return e.node===t[1].slice(13)&&e.output===t[4]}));this.drawflow.drawflow[this.module].data[t[2].slice(14)].outputs[t[3]].connections.splice(e,1);var i=this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.findIndex((function(e,i){return e.node===t[2].slice(14)&&e.input===t[3]}));this.drawflow.drawflow[this.module].data[t[1].slice(13)].inputs[t[4]].connections.splice(i,1),this.dispatch("connectionRemoved",{output_id:t[2].slice(14),input_id:t[1].slice(13),output_class:t[3],input_class:t[4]}),this.connection_selected=null}}removeSingleConnection(t,e,i,n){var s=this.getModuleFromNodeId(t);if(s===this.getModuleFromNodeId(e)){if(this.drawflow.drawflow[s].data[t].outputs[i].connections.findIndex((function(t,i){return t.node==e&&t.output===n}))>-1){this.module===s&&this.container.querySelector(".connection.node_in_node-"+e+".node_out_node-"+t+"."+i+"."+n).remove();var o=this.drawflow.drawflow[s].data[t].outputs[i].connections.findIndex((function(t,i){return t.node==e&&t.output===n}));this.drawflow.drawflow[s].data[t].outputs[i].connections.splice(o,1);var a=this.drawflow.drawflow[s].data[e].inputs[n].connections.findIndex((function(e,n){return e.node==t&&e.input===i}));return this.drawflow.drawflow[s].data[e].inputs[n].connections.splice(a,1),this.dispatch("connectionRemoved",{output_id:t,input_id:e,output_class:i,input_class:n}),!0}return!1}return!1}removeConnectionNodeId(t){const e="node_in_"+t,i="node_out_"+t,n=this.container.querySelectorAll("."+i);for(var s=n.length-1;s>=0;s--){var o=n[s].classList,a=this.drawflow.drawflow[this.module].data[o[1].slice(13)].inputs[o[4]].connections.findIndex((function(t,e){return t.node===o[2].slice(14)&&t.input===o[3]}));this.drawflow.drawflow[this.module].data[o[1].slice(13)].inputs[o[4]].connections.splice(a,1);var r=this.drawflow.drawflow[this.module].data[o[2].slice(14)].outputs[o[3]].connections.findIndex((function(t,e){return t.node===o[1].slice(13)&&t.output===o[4]}));this.drawflow.drawflow[this.module].data[o[2].slice(14)].outputs[o[3]].connections.splice(r,1),n[s].remove(),this.dispatch("connectionRemoved",{output_id:o[2].slice(14),input_id:o[1].slice(13),output_class:o[3],input_class:o[4]})}const l=this.container.querySelectorAll("."+e);for(s=l.length-1;s>=0;s--)o=l[s].classList,r=this.drawflow.drawflow[this.module].data[o[2].slice(14)].outputs[o[3]].connections.findIndex((function(t,e){return t.node===o[1].slice(13)&&t.output===o[4]})),this.drawflow.drawflow[this.module].data[o[2].slice(14)].outputs[o[3]].connections.splice(r,1),a=this.drawflow.drawflow[this.module].data[o[1].slice(13)].inputs[o[4]].connections.findIndex((function(t,e){return t.node===o[2].slice(14)&&t.input===o[3]})),this.drawflow.drawflow[this.module].data[o[1].slice(13)].inputs[o[4]].connections.splice(a,1),l[s].remove(),this.dispatch("connectionRemoved",{output_id:o[2].slice(14),input_id:o[1].slice(13),output_class:o[3],input_class:o[4]})}getModuleFromNodeId(t){var e;const i=this.drawflow.drawflow;return Object.keys(i).map((function(n,s){Object.keys(i[n].data).map((function(i,s){i==t&&(e=n)}))})),e}addModule(t){this.drawflow.drawflow[t]={data:{}},this.dispatch("moduleCreated",t)}changeModule(t){this.dispatch("moduleChanged",t),this.module=t,this.precanvas.innerHTML="",this.canvas_x=0,this.canvas_y=0,this.pos_x=0,this.pos_y=0,this.mouse_x=0,this.mouse_y=0,this.zoom=1,this.zoom_last_value=1,this.precanvas.style.transform="",this.import(this.drawflow,!1)}removeModule(t){this.module===t&&this.changeModule("Home"),delete this.drawflow.drawflow[t],this.dispatch("moduleRemoved",t)}clearModuleSelected(){this.precanvas.innerHTML="",this.drawflow.drawflow[this.module]={data:{}}}clear(){this.precanvas.innerHTML="",this.drawflow={drawflow:{Home:{data:{}}}}}export(){const t=JSON.parse(JSON.stringify(this.drawflow));return this.dispatch("export",t),t}import(t,e=!0){this.clear(),this.drawflow=JSON.parse(JSON.stringify(t)),this.load(),e&&this.dispatch("import","import")}on(t,e){return"function"!=typeof e?(console.error("The listener callback must be a function, the given type is "+typeof e),!1):"string"!=typeof t?(console.error("The event name must be a string, the given type is "+typeof t),!1):(void 0===this.events[t]&&(this.events[t]={listeners:[]}),void this.events[t].listeners.push(e))}removeListener(t,e){if(void 0===this.events[t])return!1;this.events[t].listeners=this.events[t].listeners.filter(t=>t.toString()!==e.toString())}dispatch(t,e){if(void 0===this.events[t])return!1;this.events[t].listeners.forEach(t=>{t(e)})}getUuid(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}}}]).default}))},"545e":function(t,e,i){"use strict";i("10d0")},"687e":function(t,e,i){"use strict";var n=i("7a23");const s={class:"col text-end me-3",style:{position:"absolute","z-index":"5"}},o={class:"bar-zoom h2 ml-3 mt-4 text-primary"};function a(t,e){const i=Object(n["resolveComponent"])("tag-settings");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])("div",s,[Object(n["createVNode"])("div",o,[Object(n["createVNode"])("i",{class:"fas fa-search-minus cursor-pointer",onClick:e[1]||(e[1]=t=>this.editor.zoom_out())}),Object(n["createVNode"])("i",{class:"ml-2 fas fa-search cursor-pointer",onClick:e[2]||(e[2]=t=>this.editor.zoom_reset())}),Object(n["createVNode"])("i",{class:"ml-2 fas fa-search-plus cursor-pointer",onClick:e[3]||(e[3]=t=>this.editor.zoom_in())})])]),Object(n["createVNode"])("div",{ref:t.editorId,id:t.editorId,class:"drawflowContainer mt-2",onDrop:e[4]||(e[4]=(...e)=>t.drop&&t.drop(...e)),onDragover:e[5]||(e[5]=(...e)=>t.allowDrop&&t.allowDrop(...e))},null,40,["id"]),Object(n["createVNode"])(i)],64)}var r=i("9ab4");const l={class:"title-box py-1 row px-1 block-details"},d={class:"col block-title text-start"},c={class:"fst-normal h-3"},u=Object(n["createTextVNode"])(),h=Object(n["createTextVNode"])(),p={key:0,class:"text-warning fas fa-exclamation-triangle"},g={class:"text-end expand-collapse"},f=Object(n["createVNode"])("i",{class:"text-white far fa-trash-alt mr-2"},null,-1),m={class:"badge bg-secondary"},v=Object(n["createVNode"])("i",{class:"fas fa-info-circle"},null,-1);function b(t,e){const i=Object(n["resolveComponent"])("block-properties");return Object(n["openBlock"])(),Object(n["createBlock"])("div",{class:["block-"+(t.blockType&&t.blockType.toLowerCase()),"editor-block"]},[Object(n["createVNode"])("div",l,[Object(n["createVNode"])("div",d,[Object(n["createVNode"])("span",c,[Object(n["createVNode"])("i",{class:t.logoClass},null,2),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(t.nodeName),1)]),u,Object(n["createVNode"])("small",null,"("+Object(n["toDisplayString"])(t.uid)+")",1),h,t.blockOnError?(Object(n["openBlock"])(),Object(n["createBlock"])("i",p)):Object(n["createCommentVNode"])("",!0)]),Object(n["createVNode"])("div",g,[Object(n["createVNode"])("a",{onClick:e[1]||(e[1]=e=>t.deleteBlock()),title:"Delete block"},[f]),Object(n["createVNode"])("a",{onClick:e[2]||(e[2]=e=>t.toggleSettings()),title:"Toggle Settings",class:["fas text-decoration-none",t.detailsCollapsed?"fa-plus-square":"fa-minus-square"]},null,2)])]),Object(n["createVNode"])("div",{class:["text-end px-2 pb-2 block-tools",t.detailsCollapsed?"block-tools-collapsed":""]},[Object(n["createVNode"])("span",m,Object(n["toDisplayString"])(t.blockTypeDescription),1),t.latestVersion!==t.version?(Object(n["openBlock"])(),Object(n["createBlock"])("a",{key:0,onClick:e[3]||(e[3]=Object(n["withModifiers"])(e=>t.updateBlock(),["stop"])),title:"Upgrade to block's latest version",class:"fas fa-sync pt-2 refresh-block top-1 ml-2"})):Object(n["createCommentVNode"])("",!0),t.infoUrl?(Object(n["openBlock"])(),Object(n["createBlock"])("a",{key:1,href:t.infoUrl,target:"_blank",title:"More info",class:"ml-2 top-1"},[v],8,["href"])):Object(n["createCommentVNode"])("",!0)],2),t.nuid?(Object(n["openBlock"])(),Object(n["createBlock"])(i,{key:"block-properties-"+t.nuid,refresh:t.refresh,nuid:t.nuid,blockType:t.blockType,show:t.showProperties,blockId:t.uid,type:t.type,uid:t.uid,ctx:t.context,botContext:t.botContext,parameters:t.parameters,onClose:e[4]||(e[4]=e=>t.toggleSettings(!1))},null,8,["refresh","nuid","blockType","show","blockId","type","uid","ctx","botContext","parameters"])):Object(n["createCommentVNode"])("",!0)],2)}const w={novalidate:""},y={key:0},_={key:0,class:"form-group mt-2"},O={key:1,class:"form-group mt-2"},x={key:2,class:"form-group mt-2"},C=Object(n["createVNode"])("svg",{class:"sprites"},[Object(n["createVNode"])("symbol",{id:"select-arrow-down",viewbox:"0 0 10 6"},[Object(n["createVNode"])("polyline",{points:"1 1 5 5 9 1"})])],-1),T=Object(n["createVNode"])("br",null,null,-1),k={key:3,class:"form-group mt-2"},N={key:4,class:"form-group mt-2"},j={key:5,class:"form-group mt-2"};function S(t,e){const i=Object(n["resolveComponent"])("TextProperty");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Transition"],{name:"modal"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])("form",w,[Object(n["createVNode"])("div",null,[Object(n["createVNode"])("div",{class:["modal-mask p-2 b-top-1 block-properties",`block-properties-${t.blockType&&t.blockType.toLowerCase()} ${t.show?"":"d-none"}`]},[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(t.parameters,s=>(Object(n["openBlock"])(),Object(n["createBlock"])("div",null,[Object(n["createVNode"])("label",{for:t.form[s.slug],class:"text-left mt-1"},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(s.name),1),s.mandatory?(Object(n["openBlock"])(),Object(n["createBlock"])("span",y,"*")):Object(n["createCommentVNode"])("",!0)],8,["for"]),"STR"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",_,[Object(n["createVNode"])(i,{key:`${s.slug}-${t.nuid}-${t.refresh}`,settings:t.tagifyStuff.tagifySettings,class:"form-control",mode:"input",blockId:t.blockId,name:`${s.slug}-${t.nuid}`,id:`${s.slug}-${t.nuid}`,value:t.form[s.slug],placeholder:s.placeholder,invalid:t.v$.form[s.slug]&&t.v$.form[s.slug].$invalid,onChange:t.change},null,8,["settings","blockId","name","id","value","placeholder","invalid","onChange"]),Object(n["createVNode"])("small",{id:s.name+"Help",class:"form-text text-muted"},Object(n["toDisplayString"])(s.description),9,["id"])])):Object(n["createCommentVNode"])("",!0),"TXT"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",O,[Object(n["createVNode"])(i,{key:`${s.slug}-${t.nuid}`,settings:t.tagifyStuff.tagifySettings,mode:"textarea",blockId:t.blockId,name:`${s.slug}-${t.nuid}`,id:`${s.slug}-${t.nuid}`,value:t.form[s.slug],invalid:t.v$.form[s.slug]&&t.v$.form[s.slug].$invalid,onChange:t.change},null,8,["settings","blockId","name","id","value","invalid","onChange"]),Object(n["createVNode"])("small",{id:s.name+"Help",class:"form-text text-muted"},Object(n["toDisplayString"])(s.description),9,["id"])])):Object(n["createCommentVNode"])("",!0),"LIS"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",x,[Object(n["withDirectives"])(Object(n["createVNode"])("select",{class:["select",t.v$.form[s.slug]&&t.v$.form[s.slug].$invalid?"form-field-error":"form-field-ok"],"onUpdate:modelValue":e=>t.form[s.slug]=e,id:`${s.slug}-${t.blockId}`,onChange:e[1]||(e[1]=(...e)=>t.change&&t.change(...e))},[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(s.list_values,t=>(Object(n["openBlock"])(),Object(n["createBlock"])("option",{value:t.value},Object(n["toDisplayString"])(t.label),9,["value"]))),256))],42,["onUpdate:modelValue","id"]),[[n["vModelSelect"],t.form[s.slug]]]),C,T,Object(n["createVNode"])("small",{id:s.slug+"Help",class:"form-text text-muted"},Object(n["toDisplayString"])(s.description),9,["id"])])):Object(n["createCommentVNode"])("",!0),"BOO"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",k,[Object(n["withDirectives"])(Object(n["createVNode"])("input",{onChange:e[2]||(e[2]=(...e)=>t.change&&t.change(...e)),ref:s.slug,"onUpdate:modelValue":e=>t.form[s.slug]=e,type:"checkbox",name:s.slug,id:`${s.slug}-${t.nuid}`,"aria-describedby":s.name},null,40,["onUpdate:modelValue","name","id","aria-describedby"]),[[n["vModelCheckbox"],t.form[s.slug]]])])):Object(n["createCommentVNode"])("",!0),"DAT"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",N,[Object(n["withDirectives"])(Object(n["createVNode"])("input",{onInput:e[3]||(e[3]=(...e)=>t.change&&t.change(...e)),"onUpdate:modelValue":e=>t.form[s.slug]=e,type:"date",class:["form-control",t.v$.form[s.slug]&&t.v$.form[s.slug].$invalid?"form-field-error":"form-field-ok"],name:s.slug,id:`${s.slug}-${t.nuid}`,"aria-describedby":s.name,placeholder:s.placeholder},null,42,["onUpdate:modelValue","name","id","aria-describedby","placeholder"]),[[n["vModelText"],t.form[s.slug]]]),Object(n["createVNode"])("small",{id:s.name+"Help",class:"form-text text-muted"},Object(n["toDisplayString"])(s.description),9,["id"])])):Object(n["createCommentVNode"])("",!0),"NUM"===s.type?(Object(n["openBlock"])(),Object(n["createBlock"])("div",j,[Object(n["withDirectives"])(Object(n["createVNode"])("input",{onInput:e[4]||(e[4]=(...e)=>t.change&&t.change(...e)),"onUpdate:modelValue":e=>t.form[s.slug]=e,type:"number",class:["form-control",t.v$.form[s.slug]&&t.v$.form[s.slug].$invalid?"form-field-error":"form-field-ok"],name:s.slug,id:`${s.slug}-${t.nuid}`,"aria-describedby":s.name,placeholder:s.placeholder},null,42,["onUpdate:modelValue","name","id","aria-describedby","placeholder"]),[[n["vModelText"],t.form[s.slug]]]),Object(n["createVNode"])("small",{id:s.name+"Help",class:"form-text text-muted"},Object(n["toDisplayString"])(s.description),9,["id"])])):Object(n["createCommentVNode"])("",!0)]))),256))],2)])])]),_:1})}var E=i("94c2");function $(t,e){return"textarea"===t.mode?(Object(n["openBlock"])(),Object(n["createBlock"])("textarea",{key:0,name:this.$props.name,id:this.$props.id,onChange:e[1]||(e[1]=(...e)=>t.onChange&&t.onChange(...e))},null,40,["name","id"])):(Object(n["openBlock"])(),Object(n["createBlock"])("input",{key:1,name:this.$props.name,id:this.$props.id,class:"textPropertyInput",onChange:e[2]||(e[2]=(...e)=>t.onChange&&t.onChange(...e))},null,40,["name","id"]))}var L=i("d26e"),I=i.n(L);i("3db7");const B={class:"card-body"},D={class:"form-group"},M={for:"decimalsInput"},A={id:"decimalsInputHelp",class:"form-text text-muted"},R={class:"mt-2"};function V(t,e){const i=Object(n["resolveDirective"])("click-away");return t.show?Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createBlock"])("div",{key:0,class:"tagSettings",style:[{"z-index":"999",position:"absolute"},`top: ${t.y}px; left: ${t.x}px`]},[Object(n["createVNode"])("div",B,[Object(n["createVNode"])("form",null,[Object(n["createVNode"])("div",D,[Object(n["createVNode"])("h6",null,Object(n["toDisplayString"])(t.tagData.value),1),Object(n["createVNode"])("label",M,Object(n["toDisplayString"])(t.$t("tag_settings.decimals.title")),1),Object(n["withDirectives"])(Object(n["createVNode"])("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=e=>t.decimals=e),id:t.decimalsInput+"-id",name:t.decimalsInput+"-id",min:"0",max:"8",class:"form-control"},null,8,["id","name"]),[[n["vModelText"],t.decimals]]),Object(n["createVNode"])("small",A,Object(n["toDisplayString"])(t.$t("tag_settings.decimals.subtitle")),1)])]),Object(n["createVNode"])("div",R,[Object(n["createVNode"])("a",{href:"#",onClick:e[2]||(e[2]=(...e)=>t.cancel&&t.cancel(...e)),class:"card-link"},Object(n["toDisplayString"])(t.$t("global.actions.cancel")),1),Object(n["createVNode"])("a",{href:"#",onClick:e[3]||(e[3]=(...e)=>t.save&&t.save(...e)),class:"card-link"},Object(n["toDisplayString"])(t.$t("global.actions.save")),1)])])],4)),[[i,t.cancel]]):Object(n["createCommentVNode"])("",!0)}var H=Object(n["defineComponent"])({name:"TagSettings",props:{settings:Object,name:String},data:function(){return{x:0,y:0,decimals:0,show:!1,blockId:"",id:"",tagData:{},tagElement:{},tagType:String}},methods:{cancel:function(){this.show=!1},save:function(){this.tagData["decimals"]=this.decimals,this.tagData["type"]=this.tagType,E["a"].emitter.emit("tag-property-settings-"+this.id,this.tagElement,this.tagData),this.show=!1}},created:function(){var t=this;E["a"].emitter.on("tag-property-settings",(function(e,i){t.x=i.x,t.y=i.y,t.id=i.id,t.blockId=e,t.show=!0,t.tagData=i.tag.data,t.tagElement=i.tag.tag,t.decimals=i.tag.data.decimals||2,t.tagType=i.tag.data.type}))}});i("8bda");H.render=V;var z=H,P=null,F=Object(n["defineComponent"])({name:"Tags",props:{mode:String,settings:Object,name:String,id:String,blockId:String,value:[String,Array],onChange:Function,invalid:Boolean},components:{TagSettings:z},data:function(){return{tagify:P,modifiedValue:this.$props.value}},methods:{getTagIndexByValue:function(t,e){var i=t.find((function(t){return t.value===e}));return i},getWhitelistItemByValue:function(t){var e=this.tagify.settings.whitelist.find((function(e){return e.value===t}));return e},escapeRegExp:function(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},replaceAll:function(t,e,i){return t.replace(new RegExp(this.escapeRegExp(e),"g"),i)},formClass:function(){this.tagify.toggleClass("form-field-error")}},watch:{invalid:function(){this.formClass()},value:{deep:!0,handler:function(t){this.modifiedValue=t}},settings:{deep:!0,immediate:!1,handler:function(t){var e;if(t&&t.whitelist&&this.tagify.settings&&JSON.stringify(t.whitelist)!==JSON.stringify(this.tagify.settings.whitelist)){for(var i=this.tagify.settings.whitelist.filter((function(e){return!t.whitelist.includes(e)})),n=0;n<i.length;n++)if(this.modifiedValue){e=this.tagify.getCleanValue();var s=this.getTagIndexByValue(e,i[n].value);if(void 0!==s){var o=s.decimals?',"decimals":"'+s.decimals+'"':"",a=s.type?',"type":"'+s.type+'"':"",r='[[{"value":"'+s.value+'","text":"'+s.text+'","title":"'+s.title+'"'+a+',"style":"'+s.style+'","prefix":"'+s.prefix+'"'+o+"}]]";this.tagify.removeTags(i[n].value),this.modifiedValue=this.replaceAll(this.modifiedValue,r,""),E["a"].emitter.emit("block-properties-remove-tag-from-field-"+this.blockId,this.blockId,{id:this.id,value:r})}}this.tagify.settings.whitelist=t.whitelist,this.tagify.loadOriginalValues(this.modifiedValue)}}}},beforeUnmount:function(){this.tagify.destroy()},created:function(){var t=this;E["a"].emitter.on("tag-property-settings-"+this.id,(function(e,i){t.tagify.replaceTag(e,i)}))},mounted:function(){var t=this;this.settings.templates.tag=function(e){var i=t.getWhitelistItemByValue(e.value).type;try{return"<tag title='"+e.value+"' contenteditable='false' spellcheck=\"false\" class='tagify__tag "+(e.class?e.class:"")+"' "+t.tagify.getAttributes(e)+">\n                    <x title='remove tag' class='tagify__tag__removeBtn'></x>\n                    <div>\n                        <span class='tagify__tag-text'>"+e.value+"</span>\n                    </div>\n                    "+("NUM"===i?'<div><i role="button" class="fas fa-cog mt-1 tagSettingsBtn"></i></div>':"")+"\n                </tag>"}catch(n){console.error(n)}},this.tagify=new I.a(this.$el,this.settings),this.tagify.on("click",(function(e){E["a"].emitter.emit("tag-property-settings",t.blockId,{id:t.id,x:e.detail.originalEvent.clientX-120,y:e.detail.originalEvent.clientY+32,tag:e.detail})})),this.$props.invalid&&this.formClass(),this.value&&this.tagify.loadOriginalValues(this.value)}});i("41e3");F.render=$;var q=F,W=i("25a0"),U=i("e3e1"),X={},J=Object(n["defineComponent"])({name:"PropertiesComponent",props:{parameters:[],blockId:String,ctx:Object,show:Boolean,botContext:[],uid:Number,nuid:String,blockType:String,refresh:Number},setup:function(){var t=Object(n["reactive"])({value:"",tagifySettings:{autoComplete:{enabled:!0},duplicates:!0,tagTextProp:"value",pattern:"#",mode:"mix",enforceWhitelist:!0,mixMode:{insertAfterTag:" "},editTags:!1,templates:{dropdownItem:e},transformTag:i,whitelist:[],dropdown:{enabled:0,maxItems:100,position:"text",mapValueTo:"value",highlightFirst:!0,placeAbove:!0}}});function e(t){return'<div class="tagify__dropdown__item">\n        <i class="fas fa-database"></i>\n        <span class="ml-2">'+t.value+"</span>\n      </div>"}function i(t){t.style="--tag-bg: #aee8be"}return{tagifyStuff:t,v$:Object(W["a"])()}},mounted:function(){this.tagifyStuff.tagifySettings.whitelist=[],this.context={},this.form={},this.validations={}},validations:function(){return this.validations},data:function(){return{context:X,form:{},validations:{}}},components:{TextProperty:q},watch:{botContext:{handler:function(t){t.length&&t.length>0?this.tagifyStuff.tagifySettings.whitelist=null===t||void 0===t?void 0:t.map((function(t){return"string"==typeof t?{value:t}:t})):this.tagifyStuff.tagifySettings.whitelist=[]}},parameters:{handler:function(t){var e=this;if(t&&0!==t.length){for(var i={form:{}},n=this.$props.parameters,s=0,o=n;s<o.length;s++){var a=o[s];a.mandatory&&"BOO"!==a.type&&(i["form"][a.slug]={required:U["c"]}),"BOO"===a.type?this.form[a.slug]=this.form[a.slug]||!0:"LIS"===a.type&&(this.form[a.slug]=this.form[a.slug]||a.placeholder),E["a"].emitter.on("block-properties-remove-tag-from-field-"+this.$props.blockId,(function(t,i){e.removeTagValueFromField(i.id.substring(0,i.id.indexOf("-")),i.value)})),E["a"].emitter.emit("block-properties-change",this.$props.blockId,{field:a.slug,value:this.form[a.slug],error:!1,params:n,blockUuid:this.nuid,blockType:this.blockType})}this.validations=i,setTimeout(this.sendErrorStatus,100)}}},ctx:{handler:function(t){this.form=t}}},methods:{removeTagValueFromField:function(t,e){this.form[t]&&(this.form[t]=this.form[t].replace(e,"")),this.v$.$touch(),this.validateField(t,this.form[t])},validateField:function(t,e){E["a"].emitter.emit("block-properties-change",this.$props.blockId,{field:t,value:e,error:this.v$.$error,params:this.$props.parameters,blockUuid:this.nuid,blockType:this.blockType}),this.sendErrorStatus()},getTagMatchesForField:function(t){var e,i=/\[\[\{"value":"(.*?)","text":/gm,n=[];while(null!==(e=i.exec(t)))e.index===i.lastIndex&&i.lastIndex++,n.push({value:e[0],tag:e[1]});return n},updateField:function(t,e,i){e===this.blockId&&(this.form[t]=i,E["a"].emitter.emit("block-properties-change",this.$props.blockId,{field:t,value:i,error:this.v$.$error,params:this.$props.parameters,blockUuid:this.nuid,blockType:this.blockType}),E["a"].emitter.emit("block-properties-tag-removal",this.$props.blockId))},sendErrorStatus:function(){this.v$.$touch(),E["a"].emitter.emit("block-properties-error-"+this.nuid,this.blockId,this.v$.$error)},change:function(t){var e="",i="";t.target?(e="checkbox"===t.target.type?t.target.checked:t.target.value,i=t.target.id):(e=t.value,i=t.id),i=i.substring(0,i.indexOf("-")),this.form[i]=e,this.validateField(i,e)}}});i("545e");J.render=S;var K=J,Y=Object(n["defineComponent"])({name:"EditorBlockComponent",props:{id:Number,description:String,logo_class:String,nodeData:Object,nuid:String},components:{BlockProperties:K},computed:{blockTypeDescription:function(){var t="";switch(this.blockType){case"TRG":t="Trigger";break;case"OPR":t="Operation";break;case"LOG":t="Logic";break;case"ACT":t="Action";break}return t}},data:function(){return{showProperties:!0,context:{},nodeName:"",infoUrl:"",logoClass:this.$props.logo_class,blockType:"",output_vars:[],parameters:[],botContext:{},blockOnError:!1,version:0,blockTypeId:"",uid:this.$props.nodeData?this.$props.nodeData.id:null,detailsCollapsed:!1,refresh:0,latestVersion:0}},mounted:function(){var t=this;this.botContext={},this.context={};var e=this.id,i=this.nuid;this.resetEventListeners(),setTimeout((function(){E["a"].emitter.emit("editor-block-data-request",i,e)}),40),E["a"].emitter.on("editor-block-data-response-"+i,this.setCtx),E["a"].emitter.on("block-properties-error-"+i,this.setError),E["a"].emitter.on("editor-block-update-block-response-"+this.id,(function(e){t.blockType=e.block_type,t.parameters=e.parameters,t.output_vars=e.output_vars,t.infoUrl=e.info_url,t.version=e.version,t.logoClass=e.logo_class,t.nodeName=e.name,t.latestVersion=e.version,E["a"].emitter.emit("editor-block-update-block-updated",i,!0,e)}))},watch:{uid:{handler:function(t){E["a"].emitter.emit("editor-block-data-ctx-add",this.uid,this.output_vars),E["a"].emitter.on("editor-block-bot-context-update-"+t,this.setBotContext)}}},methods:{deleteBlock:function(){E["a"].emitter.emit("editor-block-delete",this.uid)},resetEventListeners:function(){E["a"].emitter.off("editor-block-data-response-"+this.uid),E["a"].emitter.off("editor-block-update-block-response-"+this.id),E["a"].emitter.off("block-properties-error-"+this.nuid)},filterCtx:function(t,e){for(var i=[],n=0;n<t.length;n++){var s=t[n].value;e.indexOf(s.substring(1,s.indexOf(".")))>-1&&i.push(t[n])}return i},setBotContext:function(t,e){this.botContext=this.filterCtx(t,e)},updateBlock:function(){this.refresh=1,E["a"].emitter.emit("editor-block-update-block",this.id,{nuid:this.nuid,blockTypeId:this.blockTypeId,uid:this.uid})},setCtx:function(t,e){if(t){for(var i in this.context={},t.data)this.context[i]=t.data[i];this.nodeName=t.nodeName,this.uid=t.id,this.infoUrl=t.info_url,this.blockType=t.block_type,this.parameters=t.parameters,this.output_vars=t.output_vars,this.blockTypeId=t.name,this.logoClass=t.logo_class,this.version=t.version,this.latestVersion=e}},setError:function(t,e){t===this.uid&&(this.blockOnError=e),E["a"].emitter.emit("editor-block-error",t,e)},toggleSettings:function(t){this.showProperties=t||!this.showProperties,this.detailsCollapsed=!this.detailsCollapsed}}});i("05d4");Y.render=b;var G=Y,Q=i("52e1"),Z=i.n(Q),tt=i("ec26"),et=null,it=null,nt={},st=[],ot=Object(n["defineComponent"])({name:"DrawFlowComponent",props:{authToken:String,blocks:Array,editorId:String,bot:Object,usesTemplate:Boolean,showZoom:Boolean},components:{EditorBlock:G,TagSettings:z},setup:function(){return{appVersion:i("d490").version}},data:function(){return{editor:null,mobile_item_selec:et,mobile_last_move:it,transform:"",isLoading:!1,fieldsContext:st,nodesStatuses:nt,validationStatus:!1,botId:null,activation:{show:!1,loading:!1},selectedNode:0}},mounted:function(){return Object(r["b"])(this,void 0,void 0,(function(){var t,e,i,n,s=this;return Object(r["c"])(this,(function(o){try{for(this.initDiagram(),this.initContext(),this.resetEventListeners(),this.bot&&(t=this.bot,e=null===t||void 0===t?void 0:t.json.data,this.initNodesStatuses(e),this.updateEditorBot(e,null===t||void 0===t?void 0:t.json.context.nodes)),i=document.getElementsByClassName("drag-drawflow"),n=0;n<i.length;n++)i[n].addEventListener("touchend",this.drop,!1),i[n].addEventListener("touchmove",this.positionMobile,!1),i[n].addEventListener("touchstart",this.drag,!1);E["a"].emitter.on("block-properties-change",(function(t,e){var i=s.editor.drawflow.drawflow.Home;i.data[t]&&i.context.nodes[e.blockUuid]&&(i.data[t].data[e.field]=e.value,i.data[t].parameters=e.params,i.context.nodes[e.blockUuid].parameters=e.params,i.context.nodes[e.blockUuid].block_type=e.blockType),s.validationStatusCheck()})),E["a"].emitter.on("editor-block-update-block",(function(t,e){var i=s.getBlockByTypeId(e.blockTypeId),n=s.editor.drawflow.drawflow.Home.data,o=i.id;i.id=t,s.editor.drawflow.drawflow.Home.context.nodes[e.nuid]=i,s.editor.drawflow.drawflow.Home.context.nodes[e.nuid].type=o,n[e.uid].block_type=i.block_type,n[e.uid].info_url=i.info_url,n[e.uid].logo_class=i.logo_class,n[e.uid].nodeName=i.name,n[e.uid].output_vars=i.output_vars,n[e.uid].parameters=i.parameters,n[t]=s.cleanOldKeys(n[e.uid]),s.updateAllFieldsContext(n),s.sendBotContext(n),s.checkBotScheduleType(),E["a"].emitter.emit("editor-block-update-block-response-"+t,i)})),E["a"].emitter.on("editor-block-data-request",(function(t){var e=s.editor.drawflow.drawflow["Home"],i=e.context.nodes[t];if(i&&e.data[i.id]){var n=i.id,o=s.getBlockByTypeId(i.type);e.data[n]["parameters"]=i.parameters,e.data[n]["nodeName"]=i.name,e.data[n]["info_url"]=i.info_url,e.data[n]["block_type"]=i.block_type,e.data[n]["version"]=i.version,e.data[n]["output_vars"]=i.output_vars,e.data[n]["logo_class"]=i.logo_class;var a=o&&o.version?o.version:0;E["a"].emitter.emit("editor-block-data-response-"+t,e.data[n],a)}})),E["a"].emitter.on("editor-block-data-ctx-add",(function(t,e){t&&s.updateFieldsContext(t,e)})),E["a"].emitter.on("editor-block-delete",(function(t){s.editor.removeNodeId("node-"+t)})),this.editor.on("connectionCreated",this.connectionCreated),this.editor.on("connectionRemoved",this.connectionRemoved),this.editor.on("nodeRemoved",this.removeNode),this.editor.on("beforeNodeRemoved",this.beforeRemoveNode),this.editor.on("nodeSelected",this.selectNode),this.editor.on("nodeUnselected",this.unselectNode),E["a"].emitter.on("editor-block-error",(function(t,e){var i=s.editor.drawflow.drawflow.Home.context.nodes,n=Object.keys(i).find((function(e){return i[e].id===t}));n&&(s.nodesStatuses[t]=e),s.validationStatusCheck()})),setTimeout((function(){s.refreshConnections()}),410)}catch(a){console.error(a)}return[2]}))}))},watch:{bot:{deep:!0,handler:function(t,e){if(e&&t&&t.id!==e.id||!e){var i=t,n=null===i||void 0===i?void 0:i.json.data;n&&this.updateEditorBot(n,null===i||void 0===i?void 0:i.json.context.nodes)}}}},methods:{connectionCreated:function(t){this.sendContext(t.input_id,t.output_id)},connectionRemoved:function(t){this.sendContext(t.input_id,t.output_id)},getBlockByTypeId:function(t){var e=this.blocks.map((function(t){return Object.assign({},t)})),i=e.find((function(e){return e.id===t}));return i},updateAllFieldsContext:function(t){for(var e in t)this.updateFieldsContext(e,t[e].output_vars)},updateFieldsContext:function(t,e){var i=function(i){var s=e[i],o="#"+t+"."+s.slug;n.fieldsContext.find((function(t){return t.value===o}))||n.fieldsContext.push({value:o,text:s.name,title:s.description,type:s.type})},n=this;for(var s in e)i(s)},cleanOldKeys:function(t){return["blockType","infoUrl"].forEach((function(e){delete t[e]})),t},resetEventListeners:function(){E["a"].emitter.off("editor-block-update-block"),E["a"].emitter.off("block-properties-error"),E["a"].emitter.off("block-properties-change"),E["a"].emitter.off("editor-block-data-request"),E["a"].emitter.off("editor-block-data-ctx-add"),E["a"].emitter.off("editor-block-delete")},refreshConnections:function(){for(var t in this.editor.drawflow.drawflow.Home.data)this.editor.updateConnectionNodes("node-"+t)},initNodesStatuses:function(t){for(var e=0,i=Object.keys(t);e<i.length;e++){var n=i[e];this.nodesStatuses[n]=!1}},selectNode:function(t){this.selectedNode=t},unselectNode:function(){this.selectedNode=0},updateEditorBot:function(t,e){var i=this;setTimeout((function(){i.registerBlocks(t),i.editor.import({drawflow:{Home:{context:{nodes:e},data:t}}}),i.checkBotScheduleType(),setTimeout((function(){i.sendBotContext(t)}),160)}),10)},export:function(){var t=this.editor.export(),e=t.drawflow.Home,i={json:e};return i},registerBlocks:function(t){for(var e=0,i=Object.entries(t);e<i.length;e++){var n=i[e],s=n[1];this.registerBlock(s,s.html)}},registerBlock:function(t,e){t["nuid"]=e;var i=t,n={uid:e,parameters:t.parameters};this.editor.registerNode(e,G,i,n)},positionMobile:function(t){this.mobile_last_move=t},allowDrop:function(t){t.preventDefault()},drag:function(t){"touchstart"===t.type?this.mobile_item_selec=t.target.closest(".drag-drawflow").getAttribute("data-node"):t.dataTransfer.setData("node",t.target.getAttribute("data-node"))},drop:function(t){var e=t.dataTransfer.getData("node"),i=t.dataTransfer.getData("data"),n=JSON.parse(i);if("touchend"===t.type){var s=this.mobile_last_move.touches[0].clientX,o=this.mobile_last_move.touches[0].clientY,a=document.elementFromPoint(s,o),r=a.closest("#"+this.$props.editorId);null!=r&&this.addNodeToDrawFlow(this.mobile_item_selec,JSON.parse(this.mobile_item_selec),s,o),this.mobile_item_selec=""}else t.preventDefault(),this.addNodeToDrawFlow(e,n,t.clientX,t.clientY);this.checkBotScheduleType()},checkBotScheduleType:function(){var t=this.areThereTriggersInBot(),e=t?"ADH":"SCH";E["a"].emitter.emit("editor-trigger-type",e)},areThereTriggersInBot:function(){var t=this.editor.drawflow.drawflow.Home.context.nodes,e=Object.keys(this.editor.drawflow.drawflow.Home.data),i=Object.keys(t).find((function(i){return"TRG"===t[i].block_type&&e.indexOf(String(t[i].id))>-1}));return Boolean(i)},clearBot:function(){this.editor.clear(),this.editor.noderegister={},this.fieldsContext=[],this.editor.nodeId=1,this.initContext()},emitValidStatus:function(t){setTimeout((function(){E["a"].emitter.emit("editor-valid-status",t)}),160)},validationStatusCheck:function(){for(var t=0,e=Object.entries(this.nodesStatuses);t<e.length;t++){var i=e[t],n=i[1];if(n)return this.validationStatus=!1,void this.emitValidStatus(!1)}this.validationStatus=!0,this.emitValidStatus(!0)},getPreviousNodes:function(t,e){var i=this.editor.drawflow.drawflow["Home"].data,n=i[t].inputs,s=[];for(var o in e&&(s=e),n)for(var a=n[o],r=0;r<a.connections.length;r++){var l=a.connections;s.push(l[r].node),this.getPreviousNodes(l[r].node,s)}return Array.from(new Set(s))},getForwardNodes:function(t,e){var i=this.editor.drawflow.drawflow["Home"].data,n=i[t].outputs,s=[];for(var o in e&&(s=e),n)for(var a=n[o],r=0;r<a.connections.length;r++){var l=a.connections;l[r].node!==t&&(s.push(l[r].node),this.getForwardNodes(l[r].node,s))}return Array.from(new Set(s))},initContext:function(){this.editor&&this.editor.clear(),this.editor.drawflow.drawflow["Home"].context={},this.editor.drawflow.drawflow["Home"].context.nodes={},this.editor.drawflow.drawflow["Home"].context.appVersion=this.appVersion},initDiagram:function(){var t,e=document.getElementById(this.$props.editorId);this.editor=null,this.editor=new Z.a(e,n),this.editor.draggable_inputs=!1,this.editor.reroute=!0,this.editor.reroute_width=3,this.editor.removeNodeId=function(t){var e=t.slice(5),i="Home",n=this.drawflow.drawflow[i].data[e];n&&this.dispatch("beforeNodeRemoved",n),this.removeConnectionNodeId(t),this.module===i&&this.container.querySelector("#"+t).remove(),this.dispatch("nodeRemoved",t.slice(5)),delete this.drawflow.drawflow[i].data[e]},null===(t=this.editor)||void 0===t||t.start()},addNodeToDrawFlow:function(t,e,i,n){if("fixed"===this.editor.editor_mode)return!1;i=i*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().x*(this.editor.precanvas.clientWidth/(this.editor.precanvas.clientWidth*this.editor.zoom)),n=n*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom))-this.editor.precanvas.getBoundingClientRect().y*(this.editor.precanvas.clientHeight/(this.editor.precanvas.clientHeight*this.editor.zoom));var s=e.id,o=Object(tt["a"])();this.registerBlock(e,o);var a=this.editor.addNode(s,e.inputs,e.outputs,i,n,"class",{},o,"vue");this.editor.drawflow.drawflow["Home"].context.nodes[o]={type:s,id:a,parameters:e.parameters,info_url:e.info_url,block_type:e.block_type,logo_class:e.logo_class,name:e.name,version:e.version,output_vars:e.output_vars}},sendBotContext:function(t){for(var e in t){var i=t[e].id,n=this.getPreviousNodes(parseInt(i));this.updateBlockContext(i,n)}},updateBlockContext:function(t,e){E["a"].emitter.emit("editor-block-bot-context-update-"+t,this.fieldsContext,e)},beforeRemoveNode:function(t){if(t.outputs.output_1&&t.inputs.input_1)for(var e=t.outputs.output_1.connections,i=t.inputs.input_1.connections,n=this.editor.drawflow.drawflow["Home"].data,s=this.getPreviousNodes(t.id),o=0,a=i;o<a.length;o++)for(var r=a[o],l=0,d=e;l<d.length;l++)for(var c=d[l],u=0,h=Object.entries(n[c.node].data);u<h.length;u++){for(var p=h[u],g=(p[0],p[1]),f=!1,m=0,v=s;m<v.length;m++){var b=v[m];if(g&&g.indexOf("#"+b+".")>-1){f=!0;break}}if(f){this.editor.addConnection(r.node,c.node,"output_1","input_1");break}}},removeNode:function(t){delete this.nodesStatuses[t],0===Object.keys(this.nodesStatuses).length&&(this.validationStatus=!0);for(var e=this.editor.drawflow.drawflow["Home"].context.nodes,i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];String(e[s].id)===t&&delete e[s]}this.checkBotScheduleType(),this.validationStatusCheck()},sendContext:function(t,e){var i=parseInt(t),n=this.getForwardNodes(i),s=this.getPreviousNodes(i),o=this.fieldsContext.filter((function(t){var e=t.value;return s.indexOf(e.substring(1,e.indexOf(".")))>-1}));E["a"].emitter.emit("editor-block-bot-context-update-"+i,o,s);for(var a=function(t){var e=r.getPreviousNodes(parseInt(n[t])),i=r.fieldsContext.filter((function(t){var i=t.value;return e.indexOf(i.substring(1,i.indexOf(".")))>-1}));E["a"].emitter.emit("editor-block-bot-context-update-"+n[t],i,e)},r=this,l=0;l<n.length;l++)a(l)}}});i("250d");ot.render=a;e["a"]=ot},"72dd":function(t,e,i){"use strict";i.d(e,"g",(function(){return s}));var n=i("7a23");i.d(e,"a",(function(){return n["computed"]})),i.d(e,"b",(function(){return n["getCurrentInstance"]})),i.d(e,"c",(function(){return n["inject"]})),i.d(e,"d",(function(){return n["isReactive"]})),i.d(e,"e",(function(){return n["isReadonly"]})),i.d(e,"f",(function(){return n["isRef"]})),i.d(e,"h",(function(){return n["nextTick"]})),i.d(e,"i",(function(){return n["onBeforeMount"]})),i.d(e,"j",(function(){return n["onBeforeUnmount"]})),i.d(e,"k",(function(){return n["provide"]})),i.d(e,"l",(function(){return n["reactive"]})),i.d(e,"m",(function(){return n["ref"]})),i.d(e,"n",(function(){return n["unref"]})),i.d(e,"o",(function(){return n["watch"]}));var s=!0},"7b62":function(t,e,i){},8872:function(t,e,i){},"8a14":function(t,e,i){"use strict";var n=i("7a23"),s=Object(n["defineComponent"])({name:"spinner",props:{color:{type:String,default:"#000"},height:{type:Number,default:64},width:{type:Number,default:64}}});
/**
 * Vue 3 Loading Overlay 0.0.0
 * (c) 2020
 * @license MIT
 */const o=Object(n["createVNode"])("g",{fill:"none","fill-rule":"evenodd"},[Object(n["createVNode"])("g",{transform:"translate(1 1)","stroke-width":"2"},[Object(n["createVNode"])("circle",{"stroke-opacity":".25",cx:"18",cy:"18",r:"18"}),Object(n["createVNode"])("path",{d:"M36 18c0-9.94-8.06-18-18-18"},[Object(n["createVNode"])("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.8s",repeatCount:"indefinite"})])])],-1);function a(t,e,i,s,a,r){return Object(n["openBlock"])(),Object(n["createBlock"])("svg",{viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,stroke:t.color},[o],8,["width","height","stroke"])}s.render=a,s.__file="src/loaders/Spinner.vue";var r=Object(n["defineComponent"])({name:"dots",props:{color:{type:String,default:"#000"},height:{type:Number,default:240},width:{type:Number,default:60}}});const l=Object(n["createVNode"])("circle",{cx:"15",cy:"15",r:"15"},[Object(n["createVNode"])("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})],-1),d=Object(n["createVNode"])("circle",{cx:"60",cy:"15",r:"9","fill-opacity":"0.3"},[Object(n["createVNode"])("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"fill-opacity",from:"0.5",to:"0.5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})],-1),c=Object(n["createVNode"])("circle",{cx:"105",cy:"15",r:"15"},[Object(n["createVNode"])("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})],-1);function u(t,e,i,s,o,a){return Object(n["openBlock"])(),Object(n["createBlock"])("svg",{viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:t.color,width:t.width,height:t.height},[l,d,c],8,["fill","width","height"])}r.render=u,r.__file="src/loaders/Dots.vue";var h=Object(n["defineComponent"])({name:"bars",props:{color:{type:String,default:"#000"},height:{type:Number,default:40},width:{type:Number,default:40}}});const p=Object(n["createVNode"])("rect",{x:"0",y:"13",width:"4",height:"5"},[Object(n["createVNode"])("animate",{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0s",dur:"0.6s",repeatCount:"indefinite"})],-1),g=Object(n["createVNode"])("rect",{x:"10",y:"13",width:"4",height:"5"},[Object(n["createVNode"])("animate",{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"})],-1),f=Object(n["createVNode"])("rect",{x:"20",y:"13",width:"4",height:"5"},[Object(n["createVNode"])("animate",{attributeName:"height",attributeType:"XML",values:"5;21;5",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"}),Object(n["createVNode"])("animate",{attributeName:"y",attributeType:"XML",values:"13; 5; 13",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"})],-1);function m(t,e,i,s,o,a){return Object(n["openBlock"])(),Object(n["createBlock"])("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",height:t.height,width:t.width,fill:t.color},[p,g,f],8,["height","width","fill"])}h.render=m,h.__file="src/loaders/Bars.vue";var v={Spinner:s,Dots:r,Bars:h},b=Object(n["defineComponent"])({name:"vue-loading",props:{active:Boolean,programmatic:Boolean,container:[Object,Function,HTMLElement],isFullPage:{type:Boolean,default:!0},enforceFocus:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!1},transition:{type:String,default:"fade"},canCancel:Boolean,onCancel:{type:Function,default:()=>{}},color:String,backgroundColor:String,blur:{type:String,default:"2px"},opacity:Number,width:Number,height:Number,zIndex:{type:Number,default:100},loader:{type:String,default:"spinner"}},setup(t,e){const i=Object(n["ref"])(t.active),s=Object(n["computed"])(()=>{let e={background:t.backgroundColor,opacity:t.opacity,backdropFilter:`blur(${t.blur})`};return e}),o=()=>{t.programmatic&&(i.value=!1,setTimeout(()=>{},150))},a=()=>{t.canCancel&&i.value&&(o(),t.onCancel())},r=t=>{27===t.keyCode&&a()},l=()=>{t.isFullPage&&t.lockScroll&&document.body.classList.add("vld-shown")},d=()=>{t.isFullPage&&t.lockScroll&&document.body.classList.remove("vld-shown")};return Object(n["onMounted"])(()=>{t.programmatic&&(i.value=!0,document.addEventListener("keyup",r))}),Object(n["onUnmounted"])(()=>{document.removeEventListener("keyup",r)}),Object(n["watch"])(()=>t.active,()=>{i.value=t.active}),Object(n["watch"])(i,()=>{i.value?l():d()}),{isActive:i,bgStyle:s,hide:o,cancel:a}},components:v});const w={class:"vld-icon"};function y(t,e,i,s,o,a){return Object(n["openBlock"])(),Object(n["createBlock"])(n["Transition"],{ref:"root",name:t.transition},{default:Object(n["withCtx"])(()=>[Object(n["withDirectives"])(Object(n["createVNode"])("div",{tabindex:"0",class:["vld-overlay is-active",{"is-full-page":t.isFullPage}],"aria-busy":t.isActive,"aria-label":"Loading",style:{zIndex:t.zIndex}},[Object(n["createVNode"])("div",{class:"vld-background",onClick:e[1]||(e[1]=Object(n["withModifiers"])((...e)=>t.cancel&&t.cancel(...e),["prevent"])),style:t.bgStyle},null,4),Object(n["createVNode"])("div",w,[Object(n["renderSlot"])(t.$slots,"before"),Object(n["renderSlot"])(t.$slots,"default",{},()=>[(Object(n["openBlock"])(),Object(n["createBlock"])(Object(n["resolveDynamicComponent"])(t.loader),{color:t.color,width:t.width,height:t.height},null,8,["color","width","height"]))]),Object(n["renderSlot"])(t.$slots,"after")])],14,["aria-busy"]),[[n["vShow"],t.isActive]])]),_:3},8,["name"])}b.render=y,b.__file="src/main/Component.vue",e["a"]=b},"8bda":function(t,e,i){"use strict";i("7b62")},"8fba":function(t,e,i){"use strict";var n=i("7a23");const s={class:"modal__title"},o={class:"modal__content"},a={class:"modal__action"},r={key:0,class:"fas fa-circle-notch fa-spin"};function l(t,e){const i=Object(n["resolveComponent"])("vue-final-modal");return Object(n["openBlock"])(),Object(n["createBlock"])(i,Object(n["mergeProps"])(t.$attrs,{classes:"modal-container text-center","content-class":"modal-content modal-content-"+t.$attrs.modalSize}),{default:Object(n["withCtx"])(({params:e,close:i})=>[Object(n["createVNode"])("span",s,[Object(n["renderSlot"])(t.$slots,"title")]),Object(n["createVNode"])("div",o,[Object(n["renderSlot"])(t.$slots,"default",{params:e})]),Object(n["createVNode"])("div",a,[t.$attrs.hideCancel?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])("button",{key:0,onClick:e=>t.$emit("cancel",i),class:"boto-button secondary-btn large"},Object(n["toDisplayString"])(t.$attrs.cancelText),9,["onClick"])),t.$attrs.hideConfirm?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])("button",{key:1,onClick:e=>t.$emit("confirm",i),class:["boto-button primary-btn large ml-2",t.$attrs.confirmEnabled?"primary-btn":"btn-secondary"],disabled:!t.$attrs.confirmEnabled},[Object(n["createTextVNode"])(Object(n["toDisplayString"])(t.$attrs.confirmText)+" ",1),t.$attrs.loading?(Object(n["openBlock"])(),Object(n["createBlock"])("i",r)):Object(n["createCommentVNode"])("",!0)],10,["onClick","disabled"]))])]),_:3},16,["content-class"])}var d=Object(n["defineComponent"])({name:"BotoModal",inheritAttrs:!0,emits:["confirm","cancel"]});i("eb6e");d.render=l;e["a"]=d},"9dfc":function(t,e,i){},ac15:function(t,e,i){"use strict";var n;i.d(e,"a",(function(){return n})),function(t){t["GET"]="get",t["POST"]="post",t["PUT"]="put",t["DELETE"]="delete"}(n||(n={}))},b9cd:function(t,e,i){},d26e:function(t,e,i){!function(e,i){t.exports=i()}(0,(function(){"use strict";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function e(e){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?t(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):t(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const n=(t,e,i,n)=>(t=""+t,e=""+e,n&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase());function s(t,e){var i,n={};for(i in t)e.indexOf(i)<0&&(n[i]=t[i]);return n}function o(t){var e=document.createElement("div");return t.replace(/\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}function a(t,e){for(e=e||"previous";t=t[e+"Sibling"];)if(3==t.nodeType)return t}function r(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):t}function l(t){var e=Object.prototype.toString.call(t).split(" ")[1].slice(0,-1);return t===Object(t)&&"Array"!=e&&"Function"!=e&&"RegExp"!=e&&"HTMLUnknownElement"!=e}function d(t,e,i){function n(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(l(e[i])){l(t[i])?n(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(Array.isArray(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return t instanceof Object||(t={}),n(t,e),i&&n(t,i),t}function c(t){return String.prototype.normalize?"string"==typeof t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:t}var u=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function h(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}var p={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:""},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tag:"tagify__tag",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",inputInvalid:"tagify__input--invalid",tagX:"tagify__tag__removeBtn",tagText:"tagify__tag-text",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownInital:"tagify__dropdown--initial",scopeLoading:"tagify--loading",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}};function g(){this.dropdown={};for(let t in this._dropdown)this.dropdown[t]="function"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.settings.dropdown.enabled>=0&&this.dropdown.init()}var f={init(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownWrapperSelector)},show(t){var e,i,s,o=this.settings,a="mix"==o.mode&&!o.enforceWhitelist,r=!o.whitelist||!o.whitelist.length,d="manual"==o.dropdown.position;if(t=void 0===t?this.state.inputText:t,(!r||a||o.templates.dropdownItemNoMatch)&&!1!==o.dropdown.enable&&!this.state.isLoading){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",t),o.templates.dropdownItemNoMatch&&(s=o.templates.dropdownItemNoMatch.call(this,{value:t}))),!s){if(this.suggestedListItems.length)t&&a&&!this.state.editing.scope&&!n(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!a||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}i=""+(l(e=this.suggestedListItems[0])?e.value:e),o.autoComplete&&i&&0==i.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(s),o.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.children[0]),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),d||setTimeout(()=>{this.dropdown.position(),this.dropdown.render()}),setTimeout(()=>{this.trigger("dropdown:show",this.DOM.dropdown)})}},hide(t){var e=this.DOM,i=e.scope,n=e.dropdown,s="manual"==this.settings.dropdown.position&&!t;if(n&&document.body.contains(n)&&!s)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),i.setAttribute("aria-expanded",!1),n.parentNode.removeChild(n),setTimeout(()=>{this.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",n),this},toggle(t){this.dropdown[this.state.dropdown.visible&&!t?"hide":"show"]()},render(){var t,e,i,n=(t=this.DOM.dropdown,(i=t.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(i),e=i.clientHeight,i.parentNode.removeChild(i),e),s=this.settings;return this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(s.classNames.dropdownInital),this.dropdown.position(n),s.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(()=>this.DOM.dropdown.classList.remove(s.classNames.dropdownInital))),this},fill(t){var e;t="string"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems),this.DOM.dropdown.content.innerHTML=(e=t)?e.replace(/\>[\r\n ]+\</g,"><").replace(/(<.*?>)|\s+/g,(t,e)=>e||" "):""},refilter(t){t=t||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},position(t){var e=this.settings.dropdown;if("manual"!=e.position){var i,n,s,o,a,r,l=this.DOM.dropdown,d=e.placeAbove,c=document.documentElement.clientHeight,u=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>480?e.position:"all",h=this.DOM["input"==u?"input":"scope"];t=t||l.clientHeight,this.state.dropdown.visible&&("text"==u?(s=(i=this.getCaretGlobalPosition()).bottom,n=i.top,o=i.left,a="auto"):(r=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.parentNode;return{left:e,top:i}}(this.settings.dropdown.appendTarget),n=(i=h.getBoundingClientRect()).top-r.top,s=i.bottom-1-r.top,o=i.left-r.left,a=i.width+"px"),n=Math.floor(n),s=Math.ceil(s),d=void 0===d?c-i.bottom<t:d,l.style.cssText="left:"+(o+window.pageXOffset)+"px; width:"+a+";"+(d?"top: "+(n+window.pageYOffset)+"px":"top: "+(s+window.pageYOffset)+"px"),l.setAttribute("placement",d?"top":"bottom"),l.setAttribute("position",u))}},events:{binding(t=!0){var e=this.dropdown.events.callbacks,i=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},n=t?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[n]("resize",i.position),window[n]("keydown",i.onKeyDown)),this.DOM.dropdown[n]("mouseover",i.onMouseOver),this.DOM.dropdown[n]("mouseleave",i.onMouseLeave),this.DOM.dropdown[n]("mousedown",i.onClick),this.DOM.dropdown.content[n]("scroll",i.onScroll)},callbacks:{onKeyDown(t){var e=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),i=this.dropdown.getSuggestionDataByNode(e);switch(t.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":var n;t.preventDefault(),e&&(e=e[("ArrowUp"==t.key||"Up"==t.key?"previous":"next")+"ElementSibling"]),e||(n=this.DOM.dropdown.content.children,e=n["ArrowUp"==t.key||"Up"==t.key?n.length-1:0]),i=this.dropdown.getSuggestionDataByNode(e),this.dropdown.highlightOption(e,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":if("mix"!=this.settings.mode&&e&&!this.settings.autoComplete.rightKey&&!this.state.editing){t.preventDefault();var s=this.dropdown.getMappedValue(i);return this.input.autocomplete.set.call(this,s),!1}return!0;case"Enter":t.preventDefault(),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then(()=>{if(e)return this.dropdown.selectOption(e);this.dropdown.hide(),"mix"!=this.settings.mode&&this.addTags(this.state.inputText.trim(),!0)}).catch(t=>t);break;case"Backspace":{if("mix"==this.settings.mode||this.state.editing.scope)return;const t=this.input.raw.call(this);""!=t&&8203!=t.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}},onMouseOver(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);e&&this.dropdown.highlightOption(e)},onMouseLeave(t){this.dropdown.highlightOption()},onClick(t){if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var e=t.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode(e);this.state.actions.selectOption=!0,setTimeout(()=>this.state.actions.selectOption=!1,50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then(()=>{e?this.dropdown.selectOption(e):this.dropdown.hide()}).catch(t=>console.warn(t))}},onScroll(t){var e=t.target,i=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(i)})}}},getSuggestionDataByNode(t){var e=t?+t.getAttribute("tagifySuggestionIdx"):-1;return this.suggestedListItems[e]||null},highlightOption(t,e){var i,n=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(n),this.state.ddItemElm.removeAttribute("aria-selected")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.suggestedListItems[this.getNodeIndex(t)],this.state.ddItemData=i,this.state.ddItemElm=t,t.classList.add(n),t.setAttribute("aria-selected",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption(t){var e,i=this.settings.dropdown,n=i.clearOnSelect,s=i.closeOnSelect;if(!t)return e=this.addTags(this.state.inputText,!0),void(s&&this.dropdown.hide());var o=t.getAttribute("tagifySuggestionIdx"),a=this.suggestedListItems[+o];this.trigger("dropdown:select",{data:a,elm:t}),o&&a?(this.state.editing?this.onEditTagDone(null,d({__isValid:!0},this.normalizeTags(a)[0])):e=this["mix"==this.settings.mode?"addMixTags":"addTags"]([a],n),this.DOM.input.parentNode&&(setTimeout(()=>{this.DOM.input.focus(),this.toggleFocusClass(!0),this.placeCaretAfterNode(e)}),s?setTimeout(this.dropdown.hide.bind(this)):this.dropdown.refilter())):this.dropdown.hide()},selectAll(){return this.suggestedListItems.length=0,this.dropdown.hide(),this.addTags(this.dropdown.filterListItems(""),!0),this},filterListItems(t,e){var i,n,s,o,a,r=this.settings,d=r.dropdown,u=(e=e||{},t="select"==r.mode&&this.value.length&&this.value[0][r.tagTextProp]==t?"":t,[]),h=[],p=r.whitelist,g=d.maxItems||1/0,f=d.searchKeys,m=0;if(!t||!f.length)return(r.duplicates?p:p.filter(t=>!this.isTagDuplicate(l(t)?t.value:t))).slice(0,g);function v(t,e){return e.toLowerCase().split(" ").every(e=>t.includes(e.toLowerCase()))}for(a=d.caseSensitive?""+t:(""+t).toLowerCase();m<p.length;m++){let t,g;i=p[m]instanceof Object?p[m]:{value:p[m]};let b=Object.keys(i).some(t=>f.includes(t))?f:["value"];d.fuzzySearch&&!e.exact?(s=b.reduce((t,e)=>t+" "+(i[e]||""),"").toLowerCase().trim(),d.accentedSearch&&(s=c(s),a=c(a)),t=0==s.indexOf(a),g=s===a,n=v(s,a)):(t=!0,n=b.some(t=>{var n=""+(i[t]||"");return d.accentedSearch&&(n=c(n),a=c(a)),d.caseSensitive||(n=n.toLowerCase()),g=n===a,e.exact?n===a:0==n.indexOf(a)})),o=!r.duplicates&&this.isTagDuplicate(l(i)?i.value:i),n&&!o&&(g&&t?h.push(i):"startsWith"==d.sortby&&t?u.unshift(i):u.push(i))}return"function"==typeof d.sortby?d.sortby(h.concat(u),a):h.concat(u).slice(0,g)},getMappedValue(t){var e=this.settings.dropdown.mapValueTo;return e?"function"==typeof e?e(t):t[e]||t.value:t.value},createListHTML(t){return d([],t).map((t,e)=>{"string"!=typeof t&&"number"!=typeof t||(t={value:t});var i=this.dropdown.getMappedValue(t);t.value=i&&"string"==typeof i?r(i):i;var n=this.settings.templates.dropdownItem.apply(this,[t,this]);return n.replace(/\s*tagifySuggestionIdx=(["'])(.*?)\1/gim,"").replace(">",` tagifySuggestionIdx="${e}">`)}).join("")}};const m="@yaireo/tagify/";var v,b={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},w={wrapper:(t,e)=>`<tags class="${e.classNames.namespace} ${e.mode?""+e.classNames[e.mode+"Mode"]:""} ${t.className}"\n                    ${e.readonly?"readonly":""}\n                    ${e.disabled?"disabled":""}\n                    ${e.required?"required":""}\n                    tabIndex="-1">\n            <span ${!e.readonly&&e.userInput?"contenteditable":""} tabIndex="0" data-placeholder="${e.placeholder||"&#8203;"}" aria-placeholder="${e.placeholder||""}"\n                class="${e.classNames.input}"\n                role="textbox"\n                aria-autocomplete="both"\n                aria-multiline="${"mix"==e.mode}"></span>\n        </tags>`,tag(t,e){var i=this.settings;return`<tag title="${t.title||t.value}"\n                    contenteditable='false'\n                    spellcheck='false'\n                    tabIndex="${i.a11y.focusableTags?0:-1}"\n                    class="${i.classNames.tag} ${t.class||""}"\n                    ${this.getAttributes(t)}>\n            <x title='' class="${i.classNames.tagX}" role='button' aria-label='remove tag'></x>\n            <div>\n                <span class="${i.classNames.tagText}">${t[i.tagTextProp]||t.value}</span>\n            </div>\n        </tag>`},dropdown(t){var e=t.dropdown,i="manual"==e.position,n=""+t.classNames.dropdown;return`<div class="${i?"":n} ${e.classname}" role="listbox" aria-labelledby="dropdown">\n                    <div class="${t.classNames.dropdownWrapper}"></div>\n                </div>`},dropdownItem(t,e){return`<div ${this.getAttributes(t)}\n                    class='${this.settings.classNames.dropdownItem} ${t.class?t.class:""}'\n                    tabindex="0"\n                    role="option">${t.value}</div>`},dropdownItemNoMatch:null},y={customBinding(){this.customEventsList.forEach(t=>{this.on(t,this.settings.callbacks[t])})},binding(t=!0){var e,i=this.events.callbacks,n=t?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!t){for(var s in this.state.mainEvents=t,t&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),e=this.listeners.main=this.listeners.main||{focus:["input",i.onFocusBlur.bind(this)],keydown:["input",i.onKeydown.bind(this)],click:["scope",i.onClickScope.bind(this)],dblclick:["scope",i.onDoubleClickScope.bind(this)],paste:["input",i.onPaste.bind(this)],drop:["input",i.onDrop.bind(this)]})this.DOM[e[s][0]][n](s,e[s][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(i.observeOriginalInputValue.bind(this),500);var o=this.listeners.main.inputMutationObserver||new MutationObserver(i.onInputDOMChange.bind(this));o&&o.disconnect(),"mix"==this.settings.mode&&o.observe(this.DOM.input,{childList:!0})}},bindGlobal(t){var e,i=this.events.callbacks,n=t?"removeEventListener":"addEventListener";if(t||!this.listeners.global)for(e of(this.listeners.global=this.listeners&&this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:i[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:i.onWindowKeyDown.bind(this)},{type:"blur",target:this.DOM.input,cb:i.onFocusBlur.bind(this)}],this.listeners.global))e.target[n](e.type,e.cb)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(t){var e=t.target?this.trim(t.target.textContent):"",i=this.settings,n=t.type,s=i.dropdown.enabled>=0,o={relatedTarget:t.relatedTarget},a=this.state.actions.selectOption&&(s||!i.dropdown.closeOnSelect),r=this.state.actions.addNew&&s,l=t.relatedTarget&&h.call(this,t.relatedTarget)&&this.DOM.scope.contains(t.relatedTarget);if("blur"==n){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),this.triggerChangeEvent()}if(!a&&!r)if(this.state.hasFocus="focus"==n&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=i.mode){if("focus"==n)return this.trigger("focus",o),void(0!==i.dropdown.enabled&&i.userInput||this.dropdown.show(this.value.length?"":void 0));"blur"==n&&(this.trigger("blur",o),this.loading(!1),"select"==this.settings.mode&&l&&(e=""),("select"==this.settings.mode&&e?!this.value.length||this.value[0].value!=e:e&&!this.state.actions.selectOption&&i.addTagOnBlur)&&this.addTags(e,!0),"select"!=this.settings.mode||e||this.removeTags()),this.DOM.input.removeAttribute("style"),this.dropdown.hide()}else"focus"==n?this.trigger("focus",o):"blur"==t.type&&(this.trigger("blur",o),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onWindowKeyDown(t){var e,i=document.activeElement;if(h.call(this,i)&&this.DOM.scope.contains(document.activeElement))switch(e=i.nextElementSibling,t.key){case"Backspace":this.removeTags(i),(e||this.DOM.input).focus();break;case"Enter":setTimeout(this.editTag.bind(this),0,i)}},onKeydown(t){var e=this.settings;"select"==e.mode&&e.enforceWhitelist&&this.value.length&&"Tab"!=t.key&&t.preventDefault();var i=this.trim(t.target.textContent);if(this.trigger("keydown",{originalEvent:this.cloneEvent(t)}),"mix"==e.mode){switch(t.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var n,s,r,l=document.getSelection(),d="Delete"==t.key&&l.anchorOffset==(l.anchorNode.length||0),c=l.anchorNode.previousSibling,p=1==l.anchorNode.nodeType||!l.anchorOffset&&c&&1==c.nodeType&&l.anchorNode.previousSibling,g=o(this.DOM.input.innerHTML),f=this.getTagElms();if("edit"==e.backspace&&p)return n=1==l.anchorNode.nodeType?null:l.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,n),void t.preventDefault();if(u()&&p)return r=a(p),p.hasAttribute("readonly")||p.remove(),this.DOM.input.focus(),void setTimeout(()=>{this.placeCaretAfterNode(r),this.DOM.input.click()});if("BR"==l.anchorNode.nodeName)return;if((d||p)&&1==l.anchorNode.nodeType?s=0==l.anchorOffset?d?f[0]:null:f[l.anchorOffset-1]:d?s=l.anchorNode.nextElementSibling:p&&(s=p),3==l.anchorNode.nodeType&&!l.anchorNode.nodeValue&&l.anchorNode.previousElementSibling&&t.preventDefault(),(p||d)&&!e.backspace)return void t.preventDefault();if("Range"!=l.type&&!l.anchorOffset&&l.anchorNode==this.DOM.input&&"Delete"!=t.key)return void t.preventDefault();if("Range"!=l.type&&s&&s.hasAttribute("readonly"))return void this.placeCaretAfterNode(a(s));clearTimeout(v),v=setTimeout(()=>{var t=document.getSelection(),e=o(this.DOM.input.innerHTML),i=!d&&t.anchorNode.previousSibling;if(e.length>=g.length&&i)if(h.call(this,i)&&!i.hasAttribute("readonly")){if(this.removeTags(i),this.fixFirefoxLastTagNoCaret(),2==this.DOM.input.children.length&&"BR"==this.DOM.input.children[1].tagName)return this.DOM.input.innerHTML="",this.value.length=0,!0}else i.remove();this.value=[].map.call(f,(t,e)=>{var i=this.tagData(t);if(t.parentNode||i.readonly)return i;this.trigger("remove",{tag:t,index:e,data:i})}).filter(t=>t)},20)}return!0}switch(t.key){case"Backspace":"select"==e.mode&&e.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&"manual"!=e.dropdown.position||""!=i&&8203!=i.charCodeAt(0)||(!0===e.backspace?this.removeTags():"edit"==e.backspace&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;t.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{let t=this.state.inputSuggestion||this.state.ddItemData;if(t&&e.autoComplete.rightKey)return void this.addTags([t],!0);break}case"Tab":{let n="select"==e.mode;if(!i||n)return!0;t.preventDefault()}case"Enter":if(this.state.dropdown.visible||229==t.keyCode)return;t.preventDefault(),setTimeout(()=>{this.state.actions.selectOption||this.addTags(i,!0)})}},onInput(t){if(this.postUpdate(),"mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var e=this.input.normalize.call(this),i=e.length>=this.settings.dropdown.enabled,n={value:e,inputElm:this.DOM.input};n.isValid=this.validateTag({value:e}),this.state.inputText!=e&&(this.input.set.call(this,e,!1),-1!=e.search(this.settings.delimiters)?this.addTags(e)&&this.input.set.call(this):this.settings.dropdown.enabled>=0&&this.dropdown[i?"show":"hide"](e),this.trigger("input",n))},onMixTagsInput(t){var e,i,n,s,o,a,r,l,c=this.settings,h=this.value.length,p=this.getTagElms(),g=document.createDocumentFragment(),f=window.getSelection().getRangeAt(0),m=[].map.call(p,t=>this.tagData(t).value);if("deleteContentBackward"==t.inputType&&u()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:"Backspace"}),this.value.slice().forEach(t=>{t.readonly&&!m.includes(t.value)&&g.appendChild(this.createTagElem(t))}),g.childNodes.length&&(f.insertNode(g),this.setRangeAtStartEnd(!1,g.lastChild)),p.length!=h)return this.value=[].map.call(this.getTagElms(),t=>this.tagData(t)),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(a=window.getSelection()).rangeCount>0&&3==a.anchorNode.nodeType){if((f=a.getRangeAt(0).cloneRange()).collapse(!0),f.setStart(a.focusNode,0),n=(e=f.toString().slice(0,f.endOffset)).split(c.pattern).length-1,(i=e.match(c.pattern))&&(s=e.slice(e.lastIndexOf(i[i.length-1]))),s){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:s.match(c.pattern)[0],value:s.replace(c.pattern,"")},this.state.tag.baseOffset=a.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(c.delimiters))return this.state.tag.value=this.state.tag.value.replace(c.delimiters,""),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,c.dropdown.clearOnSelect),void this.dropdown.hide();o=this.state.tag.value.length>=c.dropdown.enabled;try{r=(r=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&r.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(r||n<this.state.mixMode.matchedPatternCount)&&(o=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=n}setTimeout(()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",d({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[o?"show":"hide"](this.state.tag.value)},10)},onInputIE(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue(){this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickScope(t){var e=this.settings,i=t.target.closest("."+e.classNames.tag),n=+new Date-this.state.hasFocus;if(t.target!=this.DOM.scope){if(!t.target.classList.contains(e.classNames.tagX))return i?(this.trigger("click",{tag:i,index:this.getNodeIndex(i),data:this.tagData(i),originalEvent:this.cloneEvent(t)}),void(1!==e.editTags&&1!==e.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&("mix"==e.mode&&this.fixFirefoxLastTagNoCaret(),n>500)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&"mix"!=e.mode&&this.dropdown.show(this.value.length?"":void 0):"select"==e.mode&&!this.state.dropdown.visible&&this.dropdown.show());this.removeTags(t.target.parentNode)}else this.state.hasFocus||this.DOM.input.focus()},onPaste(t){t.preventDefault();var e,i,n=this.settings;if("select"==n.mode&&n.enforceWhitelist||!n.userInput)return!1;n.readonly||(e=t.clipboardData||window.clipboardData,i=e.getData("Text"),n.hooks.beforePaste(t,{tagify:this,pastedText:i,clipboardData:e}).then(e=>{void 0===e&&(e=i),e&&(this.injectAtCaret(e,window.getSelection().getRangeAt(0)),"mix"==this.settings.mode?this.events.callbacks.onMixTagsInput.call(this,t):this.settings.pasteAsTags?this.addTags(this.state.inputText+e,!0):this.state.inputText=e)}).catch(t=>t))},onDrop(t){t.preventDefault()},onEditTagInput(t,e){var i=t.closest("."+this.settings.classNames.tag),n=this.getNodeIndex(i),s=this.tagData(i),o=this.input.normalize.call(this,t),a=i.innerHTML!=i.__tagifyTagData.__originalHTML,r=this.validateTag({[this.settings.tagTextProp]:o});a||!0!==t.originalIsValid||(r=!0),i.classList.toggle(this.settings.classNames.tagInvalid,!0!==r),s.__isValid=r,i.title=!0===r?s.title||s.value:r,o.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=o),this.dropdown.show(o)),this.trigger("edit:input",{tag:i,index:n,data:d({},this.value[n],{newValue:o}),originalEvent:this.cloneEvent(e)})},onEditTagFocus(t){this.state.editing={scope:t,input:t.querySelector("[contenteditable]")}},onEditTagBlur(t){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t)){var e,i,n=this.settings,s=t.closest("."+n.classNames.tag),o=this.input.normalize.call(this,t),a=this.tagData(s).__originalData,r=s.innerHTML!=s.__tagifyTagData.__originalHTML,l=this.validateTag({[n.tagTextProp]:o});if(o)if(r){if(e=this.hasMaxTags(),i=this.getWhitelistItem(o)||d({},a,{[n.tagTextProp]:o,value:o,__isValid:l}),n.transformTag.call(this,i,a),!0!==(l=!e&&this.validateTag({[n.tagTextProp]:i[n.tagTextProp]}))){if(this.trigger("invalid",{data:i,tag:s,message:l}),n.editTags.keepInvalid)return;n.keepInvalidTags?i.__isValid=l:i=a}else n.keepInvalidTags&&(delete i.title,delete i["aria-invalid"],delete i.class);this.onEditTagDone(s,i)}else this.onEditTagDone(s,a);else this.onEditTagDone(s)}},onEditTagkeydown(t,e){switch(this.trigger("edit:keydown",{originalEvent:this.cloneEvent(t)}),t.key){case"Esc":case"Escape":e.innerHTML=e.__tagifyTagData.__originalHTML;case"Enter":case"Tab":t.preventDefault(),t.target.blur()}},onDoubleClickScope(t){var e,i,n=t.target.closest("."+this.settings.classNames.tag),s=this.settings;n&&s.userInput&&(e=n.classList.contains(this.settings.classNames.tagEditing),i=n.hasAttribute("readonly"),"select"==s.mode||s.readonly||e||i||!this.settings.editTags||this.editTag(n),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:n,index:this.getNodeIndex(n),data:this.tagData(n)}))},onInputDOMChange(t){t.forEach(t=>{t.addedNodes.forEach(t=>{if(t)if("<div><br></div>"==t.outerHTML)t.replaceWith(document.createElement("br"));else if(1==t.nodeType&&t.querySelector(this.settings.classNames.tagSelector)){let e=document.createTextNode("");3==t.childNodes[0].nodeType&&"BR"!=t.previousSibling.nodeName&&(e=document.createTextNode("\n")),t.replaceWith(e,...[...t.childNodes].slice(0,-1)),this.placeCaretAfterNode(e.previousSibling)}else h.call(this,t)&&t.previousSibling&&"BR"==t.previousSibling.nodeName&&(t.previousSibling.replaceWith("\n"),this.placeCaretAfterNode(t.previousSibling.previousSibling))}),t.removedNodes.forEach(t=>{t&&"BR"==t.nodeName&&h.call(this,e)&&(this.removeTags(e),this.fixFirefoxLastTagNoCaret())})});var e=this.DOM.input.lastChild;e&&""==e.nodeValue&&e.remove(),e&&"BR"==e.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};function _(t,e){return t?t.previousElementSibling&&t.previousElementSibling.classList.contains("tagify")?(console.warn("Tagify: ","input element is already Tagified",t),this):(d(this,function(t){var e=document.createTextNode("");function i(t,i,n){n&&i.split(/\s+/g).forEach(i=>e[t+"EventListener"].call(e,i,n))}return{off(t,e){return i("remove",t,e),this},on(t,e){return e&&"function"==typeof e&&i("add",t,e),this},trigger(i,n,s){var o;if(s=s||{cloneData:!0},i)if(t.settings.isJQueryPlugin)"remove"==i&&(i="removeTag"),jQuery(t.DOM.originalInput).triggerHandler(i,[n]);else{try{var a="object"==typeof n?n:{value:n};if((a=s.cloneData?d({},a):a).tagify=this,n instanceof Object)for(var r in n)n[r]instanceof HTMLElement&&(a[r]=n[r]);o=new CustomEvent(i,{detail:a})}catch(t){console.warn(t)}e.dispatchEvent(o)}}}}(this)),this.isFirefox="undefined"!=typeof InstallTrigger,this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(i=e.id,t=>{let e,n="/"+t;if(1==localStorage.getItem(m+i+"/v",1))try{e=JSON.parse(localStorage[m+i+n])}catch(t){}return e}),this.setPersistedData=(t=>t?(localStorage.setItem(m+t+"/v",1),(e,i)=>{let n="/"+i,s=JSON.stringify(e);e&&i&&(localStorage.setItem(m+t+n,s),dispatchEvent(new Event("storage")))}):()=>{})(e.id),this.clearPersistedData=(t=>e=>{const i=m+"/"+t+"/";if(e)localStorage.removeItem(i+e);else for(let t in localStorage)t.includes(i)&&localStorage.removeItem(t)})(e.id),this.applySettings(t,e),this.state={inputText:"",editing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),g.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),void(t.autofocus&&this.DOM.input.focus())):(console.warn("Tagify: ","input element not found",t),this);var i}return _.prototype={_dropdown:f,customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(t){return this.settings.trim&&t&&"string"==typeof t?t.trim():t},parseHTML:function(t){return(new DOMParser).parseFromString(t.trim(),"text/html").body.firstElementChild},templates:w,parseTemplate(t,e){return t=this.settings.templates[t]||t,this.parseHTML(t.apply(this,e))},set whitelist(t){const e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],"whitelist")},get whitelist(){return this.settings.whitelist},applySettings(t,i){p.templates=this.templates;var n=this.settings=d({},p,i);n.disabled=t.hasAttribute("disabled"),n.readonly=t.hasAttribute("readonly"),n.placeholder=t.getAttribute("placeholder")||n.placeholder||"",n.required=t.hasAttribute("required");for(let e in n.classNames)Object.defineProperty(n.classNames,e+"Selector",{get(){return"."+this[e].split(" ")[0]}});if(this.isIE&&(n.autoComplete=!1),["whitelist","blacklist"].forEach(e=>{var i=t.getAttribute("data-"+e);i&&(i=i.split(n.delimiters))instanceof Array&&(n[e]=i)}),"autoComplete"in i&&!l(i.autoComplete)&&(n.autoComplete=p.autoComplete,n.autoComplete.enabled=i.autoComplete),"mix"==n.mode&&(n.autoComplete.rightKey=!0,n.delimiters=i.delimiters||null,n.tagTextProp&&!n.dropdown.searchKeys.includes(n.tagTextProp)&&n.dropdown.searchKeys.push(n.tagTextProp)),t.pattern)try{n.pattern=new RegExp(t.pattern)}catch(t){}if(this.settings.delimiters)try{n.delimiters=new RegExp(this.settings.delimiters,"g")}catch(t){}n.disabled&&(n.userInput=!1),this.TEXTS=e(e({},b),n.texts||{}),"select"!=n.mode&&n.userInput||(n.dropdown.enabled=0),n.dropdown.appendTarget=i.dropdown&&i.dropdown.appendTarget?i.dropdown.appendTarget:document.body;let s=this.getPersistedData("whitelist");Array.isArray(s)&&(this.whitelist=Array.isArray(n.whitelist)?function(){const t=[],e={};for(let i of arguments)for(let n of i)l(n)?e[n.value]||(t.push(n),e[n.value]=1):t.includes(n)||t.push(n);return t}(n.whitelist,s):s)},getAttributes(t){var e,i=this.getCustomAttributes(t),n="";for(e in i)n+=" "+e+(void 0!==t[e]?`="${i[e]}"`:"");return n},getCustomAttributes(t){if(!l(t))return"";var e,i={};for(e in t)"__"!=e.slice(0,2)&&"class"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(i[e]=r(t[e]));return i},setStateSelection(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCaretGlobalPosition(){const t=document.getSelection();if(t.rangeCount){const e=t.getRangeAt(0),i=e.startContainer,n=e.startOffset;let s,o;if(n>0)return o=document.createRange(),o.setStart(i,n-1),o.setEnd(i,n),s=o.getBoundingClientRect(),{left:s.right,top:s.top,bottom:s.bottom};if(i.getBoundingClientRect)return i.getBoundingClientRect()}return{left:-9999,top:-9999}},getCSSVars(){var t,e=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(({value:t,unit:e})=>"s"==e?1e3*t:t)(function(t){if(!t)return{};var e=(t=t.trim().split(" ")[0]).split(/\d+/g).filter(t=>t).pop().trim();return{value:+t.split(e).filter(t=>t)[0].trim(),unit:e}}((t="tag-hide-transition",e.getPropertyValue("--"+t))))}},build(t){var e=this.DOM;this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.scope=this.parseTemplate("wrapper",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t))},destroy(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout)},loadOriginalValues(t){var e,i=this.settings;if(void 0===t){const e=this.getPersistedData("value");t=e&&!this.DOM.originalInput.value?e:i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags({withoutChangeEvent:!0}),t)if("mix"==i.mode)this.parseMixTags(t.trim()),(e=this.DOM.input.lastChild)&&"BR"==e.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(t)instanceof Array&&(t=JSON.parse(t))}catch(t){}this.addTags(t).forEach(t=>t&&t.classList.add(i.classNames.tagNoAnimation))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?"":this.DOM.originalInput.value,this.state.loadedOriginalValues=!0},cloneEvent(t){var e={};for(var i in t)e[i]=t[i];return e},loading(t){return this.state.isLoading=t,this.DOM.scope.classList[t?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading(t,e){return t&&t.classList[e?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass(t,e){"string"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleFocusClass(t){this.toggleClass(this.settings.classNames.focus,!!t)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent("change",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger("change",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:y,fixFirefoxLastTagNoCaret(){},placeCaretAfterNode(t){if(t&&t.parentNode){var e=t.nextSibling,i=window.getSelection(),n=i.getRangeAt(0);i.rangeCount&&(n.setStartAfter(e||t),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}},insertAfterTag(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e="string"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTag(t,e){t=t||this.getLastTag(),e=e||{},this.dropdown.hide();var i=this.settings;function n(){return t.querySelector(i.classNames.tagTextSelector)}var s=n(),o=this.getNodeIndex(t),a=this.tagData(t),r=this.events.callbacks,l=this,c=!0;if(s){if(!(a instanceof Object&&"editable"in a)||a.editable)return s.setAttribute("contenteditable",!0),t.classList.add(i.classNames.tagEditing),this.tagData(t,{__originalData:d({},a),__originalHTML:t.innerHTML}),s.addEventListener("focus",r.onEditTagFocus.bind(this,t)),s.addEventListener("blur",(function(){setTimeout(()=>r.onEditTagBlur.call(l,n()))})),s.addEventListener("input",r.onEditTagInput.bind(this,s)),s.addEventListener("keydown",e=>r.onEditTagkeydown.call(this,e,t)),s.focus(),this.setRangeAtStartEnd(!1,s),e.skipValidation||(c=this.editTagToggleValidity(t)),s.originalIsValid=c,this.trigger("edit:start",{tag:t,index:o,data:a,isValid:c}),this}else console.warn("Cannot find element in Tag template: .",i.classNames.tagTextSelector)},editTagToggleValidity(t,e){var i;if(e=e||this.tagData(t))return(i=!("__isValid"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!i),e.__isValid;console.warn("tag has no data: ",t,e)},onEditTagDone(t,e){e=e||{};var i={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:this.tagData(t),data:e};this.trigger("edit:beforeUpdate",i,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&e[this.settings.tagTextProp]?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),this.settings.a11y.focusableTags&&t.focus()):t&&this.removeTags(t),this.trigger("edit:updated",i),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(t,e){e&&e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&d(e,this.getInvalidTagAttrs(e,e.__isValid));var i=this.createTagElem(e);return t.parentNode.replaceChild(i,t),this.updateValueByDOMTags(),i},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),t=>{t.classList.contains(this.settings.classNames.tagNotAllowed.split(" ")[0])||this.value.push(this.tagData(t))}),this.update()},setRangeAtStartEnd(t,e){t="number"==typeof t?t:!!t,e=(e=e||this.DOM.input).lastChild||e;var i=document.getSelection();try{i.rangeCount>=1&&["Start","End"].forEach(n=>i.getRangeAt(0)["set"+n](e,t||e.length))}catch(t){}},injectAtCaret(t,e){if(e=e||this.state.selection.range)return"string"==typeof t&&(t=document.createTextNode(t)),e.deleteContents(),e.insertNode(t),this.setRangeAtStartEnd(!1,t),this.updateValueByDOMTags(),this.update(),this},input:{set(t="",e=!0){var i=this.settings.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=r(""+t)),!t&&i&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize(t){var e=t||this.DOM.input,i=[];e.childNodes.forEach(t=>3==t.nodeType&&i.push(t.nodeValue)),i=i.join("\n");try{i=i.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return i=i.replace(/\s/g," "),this.settings.trim&&(i=i.replace(/^\s+/,"")),i},autocomplete:{suggest(t){if(this.settings.autoComplete.enabled){"string"==typeof(t=t||{})&&(t={value:t});var e=t.value?""+t.value:"",i=e.substr(0,this.state.inputText.length).toLowerCase(),n=e.substring(this.state.inputText.length);e&&this.state.inputText&&i==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",n),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}},set(t){var e=this.DOM.input.getAttribute("data-suggest"),i=t||(e?this.state.inputText+e:null);return!!i&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+i)):(this.input.set.call(this,i),this.setRangeAtStartEnd()),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(t){return this.value.findIndex(e=>e.__tagId==(t||{}).__tagId)},getNodeIndex(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms(...t){var e="."+[...this.settings.classNames.tag.split(" "),...t].join(".");return[].slice.call(this.DOM.scope.querySelectorAll(e))},getLastTag(){var t=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return t[t.length-1]},tagData:(t,e,i)=>t?(e&&(t.__tagifyTagData=i?e:d({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(console.warn("tag elment doesn't exist",t,e),e),isTagDuplicate(t,e){var i=this.settings;return"select"!=i.mode&&this.value.reduce((s,o)=>n(this.trim(""+t),o.value,e||i.dropdown.caseSensitive)?s+1:s,0)},getTagIndexByValue(t){var e=[];return this.getTagElms().forEach((i,s)=>{n(this.trim(i.textContent),t,this.settings.dropdown.caseSensitive)&&e.push(s)}),e},getTagElmByValue(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag(t){t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout(()=>{t.classList.remove(this.settings.classNames.tagFlash)},100))},isTagBlacklisted(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter(e=>(""+e).toLowerCase()==t).length},isTagWhitelisted(t){return!!this.getWhitelistItem(t)},getWhitelistItem(t,e,i){e=e||"value";var s,o=this.settings;return(i=i||o.whitelist).some(i=>{var a="string"==typeof i?i:i[e]||i.value;if(n(a,t,o.dropdown.caseSensitive,o.trim))return s="string"==typeof i?{value:i}:i,!0}),s||"value"!=e||"value"==o.tagTextProp||(s=this.getWhitelistItem(t,o.tagTextProp,i)),s},validateTag(t){var e=this.settings,i="value"in t?"value":e.tagTextProp,n=this.trim(t[i]+"");return(t[i]+"").trim()?e.pattern&&e.pattern instanceof RegExp&&!e.pattern.test(n)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(n,this.state.editing)?this.TEXTS.duplicate:this.isTagBlacklisted(n)||e.enforceWhitelist&&!this.isTagWhitelisted(n)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs(t,e){return{"aria-invalid":!0,class:`${t.class||""} ${this.settings.classNames.tagNotAllowed}`.trim(),title:e}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(t,e){var i=this.settings;document.activeElement.blur(),i[e||"readonly"]=t,this.DOM.scope[(t?"set":"remove")+"Attribute"](e||"readonly",!0),"mix"==i.mode&&(this.DOM.input.contentEditable=!t)},setDisabled(t){this.setReadonly(t,"disabled")},normalizeTags(t){var e=this.settings,i=e.whitelist,n=e.delimiters,s=e.mode,o=e.tagTextProp;e.enforceWhitelist;var a=[],r=!!i&&i[0]instanceof Object,l=t instanceof Array,d=t=>(t+"").split(n).filter(t=>t).map(t=>({[o]:this.trim(t),value:this.trim(t)}));if("number"==typeof t&&(t=t.toString()),"string"==typeof t){if(!t.trim())return[];t=d(t)}else l&&(t=[].concat(...t.map(t=>t.value?t:d(t))));return r&&(t.forEach(t=>{var e=a.map(t=>t.value),i=this.dropdown.filterListItems.call(this,t[o],{exact:!0});this.settings.duplicates||(i=i.filter(t=>!e.includes(t.value)));var n=i.length>1?this.getWhitelistItem(t[o],o,i):i[0];n&&n instanceof Object?a.push(n):"mix"!=s&&(null==t.value&&(t.value=t[o]),a.push(t))}),a.length&&(t=a)),t},parseMixTags(t){var e=this.settings,i=e.mixTagsInterpolator,n=e.duplicates,s=e.transformTag,o=e.enforceWhitelist,a=e.maxTags,r=e.tagTextProp,l=[];return t=t.split(i[0]).map((t,e)=>{var d,c,u,h=t.split(i[1]),p=h[0],g=l.length==a;try{if(p==+p)throw Error;c=JSON.parse(p)}catch(t){c=this.normalizeTags(p)[0]||{value:p}}if(s.call(this,c),g||!(h.length>1)||o&&!this.isTagWhitelisted(c.value)||!n&&this.isTagDuplicate(c.value)){if(t)return e?i[0]+t:t}else c[d=c[r]?r:"value"]=this.trim(c[d]),u=this.createTagElem(c),l.push(c),u.classList.add(this.settings.classNames.tagNoAnimation),h[0]=u.outerHTML,this.value.push(c);return h.join("")}).join(""),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize(),this.getTagElms().forEach((t,e)=>this.tagData(t,l[e])),this.update({withoutChangeEvent:!0}),t},replaceTextWithNode(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i,n,s=window.getSelection(),o=s.anchorNode,a=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return o.splitText(s.anchorOffset-a),-1==(i=o.nodeValue.lastIndexOf(e))||(n=o.splitText(i),t&&o.parentNode.replaceChild(t,n)),!0}},selectTag(t,e){var i=this.settings;if(!i.enforceWhitelist||this.isTagWhitelisted(e.value)){this.input.set.call(this,e[i.tagTextProp]||e.value,!0),this.state.actions.selectOption&&setTimeout(this.setRangeAtStartEnd.bind(this));var n=this.getLastTag();return n?this.replaceTag(n,e):this.appendTag(t),i.enforceWhitelist&&this.DOM.input.removeAttribute("contenteditable"),this.value[0]=e,this.trigger("add",{tag:t,data:e}),this.update(),[t]}},addEmptyTag(t){var e=d({value:""},t||{}),i=this.createTagElem(e);this.tagData(i,e),this.appendTag(i),this.editTag(i,{skipValidation:!0})},addTags(t,e,i){var n=[],s=this.settings,o=document.createDocumentFragment();return i=i||s.skipInvalid,t&&0!=t.length?(t=this.normalizeTags(t),"mix"==s.mode?this.addMixTags(t):("select"==s.mode&&(e=!1),this.DOM.input.removeAttribute("style"),t.forEach(t=>{var e,a={},r=Object.assign({},t,{value:t.value+""});if(t=Object.assign({},r),s.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(i)return;d(a,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:r}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value))}if(t.readonly&&(a["aria-readonly"]=!0),e=this.createTagElem(t,a),n.push(e),"select"==s.mode)return this.selectTag(e,t);o.appendChild(e),t.__isValid&&!0===t.__isValid?(this.value.push(t),this.trigger("add",{tag:e,index:this.value.length-1,data:t})):(this.trigger("invalid",{data:t,index:this.value.length,tag:e,message:t.__isValid}),s.keepInvalidTags||setTimeout(()=>this.removeTags(e,!0),1e3)),this.dropdown.position()}),this.appendTag(o),this.update(),t.length&&e&&this.input.set.call(this),this.dropdown.refilter(),n)):("select"==s.mode&&this.removeAllTags(),n)},addMixTags(t){if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);"string"==typeof t&&(t=[{value:t}]);var e=!!this.state.selection,i=document.createDocumentFragment();return t.forEach(t=>{var e=this.createTagElem(t);i.appendChild(e),this.insertAfterTag(e)}),e?this.injectAtCaret(i):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(i),this.updateValueByDOMTags(),this.update()),i},prefixedTextToTag(t){var e,i=this.settings,n=this.state.tag.delimiters;if(i.transformTag.call(this,t),t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(i.pattern.source||i.pattern)[0],e=this.createTagElem(t),this.replaceTextWithNode(e)||this.DOM.input.appendChild(e),setTimeout(()=>e.classList.add(this.settings.classNames.tagNoAnimation),300),this.value.push(t),this.update(),!n){var s=this.insertAfterTag(e)||e;this.placeCaretAfterNode(s)}return this.state.tag=null,this.trigger("add",d({},{tag:e},{data:t})),e},appendTag(t){var e=this.DOM,i=e.scope.lastElementChild;i===e.input?e.scope.insertBefore(t,i):e.scope.appendChild(t)},createTagElem(t,i){t.__tagId=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));var n,s=d({},t,e({value:r(t.value+"")},i));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(n=this.parseTemplate("tag",[s])),this.tagData(n,t),n},reCheckInvalidTags(){var t=this.settings;this.getTagElms(t.classNames.tagNotAllowed).forEach((t,e)=>{var i=this.tagData(t),n=this.hasMaxTags(),s=this.validateTag(i);if(!0===s&&!n)return i=i.__preInvalidData?i.__preInvalidData:{value:i.value},this.replaceTag(t,i);t.title=n||s})},removeTags(t,e,i){var n;t=t&&t instanceof HTMLElement?[t]:t instanceof Array?t:t?[t]:[this.getLastTag()],n=t.reduce((t,e)=>{e&&"string"==typeof e&&(e=this.getTagElmByValue(e));var i=this.tagData(e);return e&&i&&!i.readonly&&t.push({node:e,idx:this.getTagIdx(i),data:this.tagData(e,{__removed:!0})}),t},[]),i="number"==typeof i?i:this.CSSVars.tagHideTransition,"select"==this.settings.mode&&(i=0,this.input.set.call(this)),1==n.length&&n[0].node.classList.contains(this.settings.classNames.tagNotAllowed)&&(e=!0),n.length&&this.settings.hooks.beforeRemoveTag(n,{tagify:this}).then(()=>{function t(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?this.settings.keepInvalidTags&&this.trigger("remove",{tag:t.node,index:t.idx}):(this.trigger("remove",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()))}i&&i>10&&1==n.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+"px",document.body.clientTop,e.node.classList.add(this.settings.classNames.tagHide),setTimeout(t.bind(this),i,e)}.call(this,n[0]):n.forEach(t.bind(this)),e||(this.removeTagsFromValue(n.map(t=>t.node)),this.update(),"select"==this.settings.mode&&this.DOM.input.setAttribute("contenteditable",!0))}).catch(t=>{})},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach(t=>t.parentNode.removeChild(t))},removeTagsFromValue(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{var e=this.tagData(t),i=this.getTagIdx(e);i>-1&&this.value.splice(i,1)})},removeAllTags(t){t=t||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.position(),"select"==this.settings.mode&&this.input.set.call(this),this.update(t)},postUpdate(){var t=this.settings.classNames,e="mix"==this.settings.mode?this.settings.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(t.hasMaxTags,this.value.length>=this.settings.maxTags),this.toggleClass(t.hasNoTags,!this.value.length),this.toggleClass(t.empty,!e)},setOriginalInputValue(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,"value"))},update(t){var e=this.getInputValue();this.setOriginalInputValue(e),this.postUpdate(),!(t||{}).withoutChangeEvent&&this.state.loadedOriginalValues&&this.triggerChangeEvent()},getInputValue(){var t=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):""},getCleanValue(t){return e=t||this.value,i=this.dataProps,e&&Array.isArray(e)&&e.map(t=>s(t,i));var e,i},getMixedTagsAsString(){var t="",e=this,i=this.settings.mixTagsInterpolator;return function n(o){o.childNodes.forEach(o=>{if(1==o.nodeType){const a=e.tagData(o);if("BR"==o.tagName&&(t+="\r\n"),"DIV"==o.tagName||"P"==o.tagName)t+="\r\n",n(o);else if(h.call(e,o)&&a){if(a.__removed)return;t+=i[0]+JSON.stringify(s(a,e.dataProps))+i[1]}}else t+=o.textContent})}(this.DOM.input),t}},_.prototype.removeTag=_.prototype.removeTags,_}))},e3e1:function(t,e,i){"use strict";i.d(e,"a",(function(){return T})),i.d(e,"b",(function(){return N})),i.d(e,"c",(function(){return S}));var n=i("72dd");function s(t){return s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function o(t,e){return a(t)||r(t,e)||l(t,e)||c()}function a(t){if(Array.isArray(t))return t}function r(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,s=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done);n=!0)if(i.push(a.value),e&&i.length===e)break}catch(l){s=!0,o=l}finally{try{n||null==r["return"]||r["return"]()}finally{if(s)throw o}}return i}}function l(t,e){if(t){if("string"===typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){return"function"===typeof t}function h(t){return null!==t&&"object"===s(t)&&!Array.isArray(t)}function p(t){return u(t.$validator)?Object.assign({},t):{$validator:t}}function g(t){return"object"===s(t)?t.$valid:t}function f(t){return t.$validator||t}function m(t,e){if(!h(t))throw new Error('[@vuelidate/validators]: First parameter to "withParams" should be an object, provided '.concat(s(t)));if(!h(e)&&!u(e))throw new Error("[@vuelidate/validators]: Validator must be a function or object with $validator parameter");var i=p(e);return i.$params=Object.assign({},i.$params||{},t),i}function v(t,e){if(!u(t)&&"string"!==typeof Object(n["n"])(t))throw new Error('[@vuelidate/validators]: First parameter to "withMessage" should be string or a function returning a string, provided '.concat(s(t)));if(!h(e)&&!u(e))throw new Error("[@vuelidate/validators]: Validator must be a function or object with $validator parameter");var i=p(e);return i.$message=t,i}function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=p(t);return Object.assign({},i,{$async:!0,$watchTargets:e})}function w(t){return{$validator:function(e){for(var i=this,s=arguments.length,a=new Array(s>1?s-1:0),r=1;r<s;r++)a[r-1]=arguments[r];return Object(n["n"])(e).reduce((function(e,n){var s=Object.entries(n).reduce((function(e,n){var s=o(n,2),r=s[0],l=s[1],d=t[r],c=Object.entries(d).reduce((function(t,e){var n=o(e,2),s=n[0],d=n[1],c=f(d),u=c.call.apply(c,[i,l].concat(a)),h=g(u);if(t.$data[s]=u,!h){var p=d.$message||"",m=d.$params||{};"function"===typeof p&&(p=p({$pending:!1,$invalid:!h,$params:m,$model:l,$response:u})),t.$errors.push({$property:r,$message:p,$params:m,$response:u,$model:l,$pending:!1,$validator:s})}return{$valid:t.$valid&&h,$data:t.$data,$errors:t.$errors}}),{$valid:!0,$data:{},$errors:[]});return e.$data[r]=c.$data,e.$errors[r]=c.$errors,{$valid:e.$valid&&c.$valid,$data:e.$data,$errors:e.$errors}}),{$valid:!0,$data:{},$errors:{}});return{$valid:e.$valid&&s.$valid,$data:e.$data.concat(s.$data),$errors:e.$errors.concat(s.$errors)}}),{$valid:!0,$data:[],$errors:[]})},$message:function(t){var e=t.$response;return e?e.$errors.map((function(t){return Object.values(t).map((function(t){return t.map((function(t){return t.$message}))})).reduce((function(t,e){return t.concat(e)}),[])})):[]}}}var y=function(t){if(t=Object(n["n"])(t),Array.isArray(t))return!!t.length;if(void 0===t||null===t)return!1;if(!1===t)return!0;if(t instanceof Date)return!isNaN(t.getTime());if("object"===s(t)){for(var e in t)return!0;return!1}return!!String(t).length},_=function(t){return t=Object(n["n"])(t),Array.isArray(t)?t.length:"object"===s(t)?Object.keys(t).length:String(t).length};function O(t){return function(e){return e=Object(n["n"])(e),!y(e)||t.test(e)}}n["n"],O(/^[a-zA-Z]*$/),O(/^[a-zA-Z0-9]*$/),O(/^\d*(\.\d+)?$/);var x=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;O(x);function C(t){return function(e){return!y(e)||_(e)<=Object(n["n"])(t)}}function T(t){return{$validator:C(t),$message:function(t){var e=t.$params;return"The maximum length allowed is ".concat(e.max)},$params:{max:t,type:"maxLength"}}}function k(t){return function(e){return!y(e)||_(e)>=Object(n["n"])(t)}}function N(t){return{$validator:k(t),$message:function(t){var e=t.$params;return"This field should be at least ".concat(e.min," long")},$params:{min:t,type:"minLength"}}}function j(t){return"string"===typeof t&&(t=t.trim()),y(t)}var S={$validator:j,$message:"Value is required",$params:{type:"required"}};var E=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i;O(E);O(/(^[0-9]*$)|(^-[0-9]+$)/),O(/^[-]?\d*(\.\d+)?$/)},eb6e:function(t,e,i){"use strict";i("8872")},f8d5:function(t,e,i){"use strict";var n=i("9ab4"),s=function(t,e,i,s,o){return Object(n["b"])(void 0,void 0,void 0,(function(){var a,r,l,d,c,u,h,p;return Object(n["c"])(this,(function(g){switch(g.label){case 0:return a=new AbortController,r=new Headers,o||r.append("Content-Type","application/json"),e&&r.append("Authorization","Token "+e),l={method:i,headers:r,cache:"no-store"},d=l.timeout,c=void 0===d?8e3:d,u=setTimeout((function(){return a.abort()}),c),s&&(l["body"]=s),[4,fetch(t,Object(n["a"])(Object(n["a"])({},l),{signal:a.signal}))];case 1:if(h=g.sent(),!h.ok)throw new Error("There was an error with this request ("+h.status+")");return[4,h.clone().json().catch((function(){return h.text()}))];case 2:return p=g.sent(),clearTimeout(u),[2,p]}}))}))},o=function(t){return"AbortError"===t.name?"The request took too long, please check your Internet connection or try again later.":t.message};e["a"]={request:s,getTextError:o}},fe26:function(t,e,i){}}]);
//# sourceMappingURL=chunk-5f96a4f0-legacy.0f314acd.js.map